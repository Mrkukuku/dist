webpackJsonp([42],{"s+S0":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("woOf"),l=a.n(i),o={components:{pagination:a("MCsY").a},data:function(){return{userType:sessionStorage.getItem("userTypes"),unitId:"",Treedata:[],typeOptions:[],tableData:[],typeOptionsData:[{type:"",desc:"全部"},{type:"1",desc:"组织架构"},{type:"2",desc:"职责制度"},{type:"3",desc:"工作计划"}],currentPage:1,rows:10,total:0,filterText:"",ruleForm:{unitId:"",title:"",type:"1",tagId:"",content:"",list:[],fileUrl:[],customTag:""},rules:{title:[{required:!0,message:"请输入标题",trigger:"blur"}],type:[{required:!0,message:"请选择类型",trigger:"blur"}],tagId:[{required:!0,message:"请选择标签",trigger:"blur"}],content:[{required:!0,message:"请输入内容",trigger:"blur"}]},defaultProps:{children:"children",label:"label"},addFalg:!0,dialogVisible:!1,imgFile:"",photoList:[],fileUrlList:[],title:"",type:""}},methods:{beforeUpload:function(t){var e=t.name.substring(t.name.lastIndexOf(".")+1),a="jpg"===e,i="png"===e,l=t.size/1024/1024<5;return a||i?l?void(this.imgFile=t):(this.$message({message:"上传文件大小不能超过 5MB!",type:"warning"}),this.$refs.upload.clearFiles(),void(this.files=null)):(this.$message({message:"上传文件只能是jpg,png格式!",type:"warning"}),this.$refs.upload.clearFiles(),void(this.imgFile=null))},uploads:function(){var t=this,e=this,a=new FormData;a.append("file",this.imgFile),a.append("fileType",10),this.axios({url:"/api/admin/file/upload",method:"post",data:a}).then(function(a){0==a.data.code?e.photoList.push({url:a.data.data.fileUrl,uid:t.imgFile.uid}):e.$alert(a.data.msg,"提示",{confirmButtonText:"OK"})})},handleRemove:function(t){for(var e in this.photoList)this.photoList[e].uid==t.uid&&this.photoList.splice(e,1)},uploadsFile:function(t){var e=this,a=new FormData;a.append("file",t.file),a.append("fileType",10),this.axios({url:"/api/admin/file/upload",method:"post",data:a}).then(function(a){0==a.data.code?e.fileUrlList.push({url:a.data.data.fileUrl,uid:t.file.uid,name:t.file.name}):(t.file,e.$alert(a.data.msg,"提示",{confirmButtonText:"OK"}))})},handleRemoveFile:function(t){for(var e in this.fileUrlList)this.fileUrlList[e].uid==t.uid&&this.fileUrlList.splice(e,1)},handleNodeClick:function(t){this.unitId=t.id,this.rows=10,this.currentPage=1,0==t.type?this.addFalg=!0:this.addFalg=!1,this.getData()},getData:function(){var t=this;this.axios({url:"/api/admin/duty/list",method:"post",data:{unitId:this.unitId,pageNum:this.currentPage,pageSize:this.rows,title:this.title,type:this.type}}).then(function(e){if(0==e.data.code){for(var a in t.tableData=e.data.list,t.tableData)1==t.tableData[a].type?t.tableData[a].typeName="组织架构":2==t.tableData[a].type?t.tableData[a].typeName="职责制度":t.tableData[a].typeName="工作计划";t.total=e.data.total}else t.$alert(e.data.msg,"提示",{confirmButtonText:"OK"})})},searchData:function(){this.currentPage=1,this.$refs.paginationChild.changePageNum(this.currentPage),this.getData()},resetData:function(){this.title="",this.type="",this.getData()},getTree:function(){var t=this;this.axios({url:"api/admin/unit/list.left",method:"post",params:{pageNum:1,pageSize:1e3}}).then(function(e){0==e.data.code?e.data.data&&(t.Treedata=e.data.data):t.$alert(e.data.msg,"提示",{confirmButtonText:"OK"})})},addBox:function(){this.dialogVisible=!0,this.getTag()},closedialog:function(){this.dialogVisible=!1,l()(this.$data.ruleForm,this.$options.data().ruleForm),delete this.ruleForm.id,this.photoList=[],this.fileUrlList=[],document.querySelector(".replyPhoto ul").innerHTML=""},handleSubmit:function(t){var e=this;this.ruleForm.list=[],this.ruleForm.fileUrl=[],this.$refs[t].validate(function(t){if(t){for(var a in e.photoList)e.ruleForm.list.push(e.photoList[a].url);for(var a in e.fileUrlList)e.ruleForm.fileUrl.push({url:e.fileUrlList[a].url,name:e.fileUrlList[a].name});e.ruleForm.unitId=e.unitId;var i="/api/admin/duty/add";e.ruleForm.id&&(i="/api/admin/duty/update"),e.axios({url:i,method:"post",data:e.ruleForm}).then(function(t){0==t.data.code?e.$alert("保存成功","提示",{confirmButtonText:"OK",callback:function(){e.closedialog(),e.getData()}}):e.$alert(t.data.msg,"提示",{confirmButtonText:"OK"})})}})},editData:function(t){var e=this;e.photoList=[],this.axios({url:"/api/admin/duty/single",method:"post",data:{id:t}}).then(function(t){if(0==t.data.code){for(var a in e.ruleForm=t.data.data,e.ruleForm.type=String(e.ruleForm.type),e.getTag(),e.ruleForm.imgUrl)e.photoList.push({url:e.ruleForm.imgUrl[a]});for(var a in e.ruleForm.fileUrl)e.fileUrlList.push({name:e.ruleForm.fileUrl[a].name,url:e.ruleForm.fileUrl[a].url});e.dialogVisible=!0}else e.$alert(t.data.msg,"提示",{confirmButtonText:"OK"})})},handleDelete:function(t){var e=this,a=this;this.$confirm("你确定要删除吗").then(function(){e.axios({url:"/api/admin/duty/delete",method:"post",data:{id:t}}).then(function(t){0==t.data.code?a.$alert("删除成功","提示",{confirmButtonText:"OK",callback:function(){e.getData()}}):a.$alert(t.data.msg,"提示",{confirmButtonText:"OK"})})})},getTag:function(){var t=this,e=this;this.axios({url:"/api/admin/duty/type",method:"post",data:{type:this.ruleForm.type}}).then(function(a){0==a.data.code?t.typeOptions=a.data.data:e.$alert(a.data.msg,"提示",{confirmButtonText:"OK"})})},radioChange:function(){console.log(this.ruleForm.type),this.getTag()},pageChange:function(t){this.currentPage=t.page_index,this.rows=t.page_limit,this.getData()}},mounted:function(){this.unitId=sessionStorage.getItem("unitId"),3==sessionStorage.getItem("userTypes")?this.getData():this.getTree()},watch:{filterText:function(t){this.$refs.tree.filter(t)}}},r={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"accountabilitySystem allcontent"},[a("el-row",{staticStyle:{height:"100%"}},[3!=t.userType?a("el-col",{staticClass:"tree_box",attrs:{span:4}},[a("div",[a("el-input",{staticClass:"filter_text",attrs:{placeholder:"输入关键字进行过滤"},model:{value:t.filterText,callback:function(e){t.filterText=e},expression:"filterText"}}),t._v(" "),a("el-tree",{ref:"tree",attrs:{data:t.Treedata,props:t.defaultProps,"highlight-current":""},on:{"node-click":t.handleNodeClick}})],1)]):t._e(),t._v(" "),a("el-col",{staticStyle:{"padding-left":"10px",height:"100%"},attrs:{span:20}},[a("div",{staticClass:"top"},[t._v("\n                    标题: "),a("el-input",{model:{value:t.title,callback:function(e){t.title=e},expression:"title"}}),t._v("\n                    \n                    类型:"),a("el-select",{attrs:{placeholder:"请选择"},model:{value:t.type,callback:function(e){t.type=e},expression:"type"}},t._l(t.typeOptionsData,function(t){return a("el-option",{key:t.type,attrs:{label:t.desc,value:t.type}})}),1),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.searchData}},[t._v("查询")]),t._v(" "),a("el-button",{on:{click:t.resetData}},[t._v("重置")]),t._v(" "),3==t.userType?[a("el-button",{style:{margin:" 0 auto"},attrs:{type:"primary"},on:{click:t.addBox}},[t._v("新增")])]:[a("el-button",{style:{margin:" 0 auto"},attrs:{type:"primary",disabled:t.addFalg},on:{click:t.addBox}},[t._v("新增")])]],2),t._v(" "),a("div",{staticClass:"bottom"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,border:""}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),t._v(" "),a("el-table-column",{attrs:{prop:"title",label:"标题",width:"220"}}),t._v(" "),a("el-table-column",{attrs:{prop:"typeName",label:"类型",width:"140"}}),t._v(" "),a("el-table-column",{attrs:{prop:"tagName",label:"标签",width:"190"}}),t._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{staticClass:"el-icon-edit",attrs:{size:"mini",type:"primary"},on:{click:function(a){return t.editData(e.row.id)}}},[t._v("编辑")]),t._v(" "),a("el-button",{staticClass:"el-icon-delete",attrs:{size:"mini",type:"danger"},on:{click:function(a){return t.handleDelete(e.row.id)}}},[t._v("删除")])]}}])})],1),t._v(" "),a("div",{staticClass:"page_all"},[a("pagination",{ref:"paginationChild",attrs:{total:t.total},on:{pageChange:t.pageChange}})],1)],1),t._v(" "),a("el-dialog",{staticClass:"dialog ",attrs:{title:"添加修改建筑信息",visible:t.dialogVisible,"close-on-click-modal":!1,"before-close":t.closedialog},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:t.ruleForm,rules:t.rules,"label-width":"150px"}},[a("el-form-item",{attrs:{label:"标题",prop:"title"}},[a("el-input",{model:{value:t.ruleForm.title,callback:function(e){t.$set(t.ruleForm,"title",e)},expression:"ruleForm.title"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"类型",prop:"type"}},[a("el-radio",{attrs:{label:"2"},on:{change:t.radioChange},model:{value:t.ruleForm.type,callback:function(e){t.$set(t.ruleForm,"type",e)},expression:"ruleForm.type"}},[t._v("职责制度")]),t._v(" "),a("el-radio",{attrs:{label:"1"},on:{change:t.radioChange},model:{value:t.ruleForm.type,callback:function(e){t.$set(t.ruleForm,"type",e)},expression:"ruleForm.type"}},[t._v("组织架构")]),t._v(" "),a("el-radio",{attrs:{label:"3"},on:{change:t.radioChange},model:{value:t.ruleForm.type,callback:function(e){t.$set(t.ruleForm,"type",e)},expression:"ruleForm.type"}},[t._v("工作计划")])],1),t._v(" "),a("el-form-item",{attrs:{label:"标签",prop:"tagId"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:t.ruleForm.tagId,callback:function(e){t.$set(t.ruleForm,"tagId",e)},expression:"ruleForm.tagId"}},t._l(t.typeOptions,function(t){return a("el-option",{key:t.type,attrs:{label:t.desc,value:t.type}})}),1)],1),t._v(" "),a("el-form-item",{attrs:{label:"自定义标签"}},[a("el-input",{model:{value:t.ruleForm.customTag,callback:function(e){t.$set(t.ruleForm,"customTag",e)},expression:"ruleForm.customTag"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"内容",prop:"content"}},[a("el-input",{attrs:{type:"textarea"},model:{value:t.ruleForm.content,callback:function(e){t.$set(t.ruleForm,"content",e)},expression:"ruleForm.content"}})],1),t._v(" "),a("el-form-item",{staticClass:"replyPhoto",attrs:{label:"图片（最多五张）"}},[a("el-upload",{staticClass:"avatar-uploader",attrs:{action:"https://jsonplaceholder.typicode.com/posts/","list-type":"picture-card","http-request":t.uploads,"on-remove":t.handleRemove,"file-list":t.photoList,"before-upload":t.beforeUpload}},[a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),t._v(" "),a("el-form-item",{staticClass:"replyfile",attrs:{label:"文件（最多三个）"}},[a("el-upload",{staticClass:"avatar-uploader",attrs:{action:"https://jsonplaceholder.typicode.com/posts/","http-request":t.uploadsFile,"file-list":t.fileUrlList,"on-remove":t.handleRemoveFile}},[a("el-button",[t._v("选择文件")])],1)],1),t._v(" "),a("el-form-item",{staticClass:"submitagency"},[a("el-button",{directives:[{name:"noMoreClick",rawName:"v-noMoreClick"}],attrs:{type:"primary"},on:{click:function(e){return t.handleSubmit("ruleForm")}}},[t._v("立即提交")]),t._v(" "),a("el-button",{on:{click:t.closedialog}},[t._v("取 消")])],1)],1)],1)],1)],1)],1)},staticRenderFns:[]};var s=a("VU/8")(o,r,!1,function(t){a("z88f")},null,null);e.default=s.exports},z88f:function(t,e){}});