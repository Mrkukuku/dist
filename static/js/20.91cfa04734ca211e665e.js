webpackJsonp([20],{L5Sa:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("g5qz"),n=a("MCsY"),s={mixins:[i.a],components:{pagination:n.a},data:function(){var t=this;return{module:"inspectionRecord",userType:"",unitId:"",currentPage:1,rows:10,total:1,addFalg:!0,tableData:[],startTime:"",endTime:"",username:"",todayCount:"",expireTimeOptionStart:{disabledDate:function(e){var a=t.endTime;return a&&e.getTime()>new Date(a).getTime()||e.getTime()>Date.now()}},expireTimeOptionEnd:{disabledDate:function(e){var a=t.startTime;return a&&e.getTime()<new Date(a).getTime()||e.getTime()>Date.now()}},fileLoading:!1,type:1,typeList:[{id:1,name:"日检"},{id:2,name:"月检"}]}},methods:{seach:function(){this.currentPage=1,this.getDatas()},getData:function(){},getDatas:function(){var t=this;this.axios({url:"/api/admin/fire/inspection/list",method:"post",data:{name:this.username,startTime:this.startTime,endTime:this.endTime,unitId:this.unitId,pageSize:this.rows,pageNum:this.currentPage}}).then(function(e){0==e.data.code&&(e.data.list.map(function(e){e.checkTime=e.checkTime&&t.$moment(e.checkTime).format("YYYY-MM-DD HH:mm")||""}),t.tableData=e.data.list,t.total=e.data.total)})},getCount:function(){var t=this;this.axios({url:"/api/admin/fire/inspection/count",method:"post",data:{unitId:this.unitId,pageSize:this.rows,pageNum:this.currentPage}}).then(function(e){0==e.data.code&&(t.todayCount=e.data.data.total)})},editData:function(t){},exportList:function(){var t=this;this.startTime&&this.endTime?(this.fileLoading=!0,this.axios({url:"/api/admin/fire/inspection/inof/excel",method:"post",data:{startTime:this.startTime,endTime:this.endTime,unitId:this.unitId}}).then(function(e){0==e.data.code?(e.data.data&&(location.href=e.data.data),t.fileLoading=!1,e.data.msg&&t.$alert(e.data.msg)):t.$alert(e.data.msg)}),setTimeout(function(){t.fileLoading=!1},2e4)):this.$alert("请选择时间")},handleReset:function(){this.username="",this.startTime="",this.endTime="",this.currentPage=1,this.$refs.paginations.changePageNum(1),this.getDatas()},renderContent:function(t,e){var a=e.node;return t("span",[t("i",{class:e.data.icon})," ",t("span",[a.label])])},handleNodeClick:function(t){this.unitId=t.id,0==t.type?this.addFalg=!0:this.addFalg=!1,this.getCount(),this.handleReset()},pageChange:function(t){this.currentPage=t.page_index,this.rows=t.page_limit,this.getDatas()}},mounted:function(){this.userType=sessionStorage.getItem("userTypes"),3==this.userType&&(this.addFalg=!1),this.unitId=Number(sessionStorage.getItem("unitId")),this.getDatas(),this.getCount()}},o={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"allcontent",attrs:{id:"inspection_record"}},[a("el-row",{staticStyle:{height:"100%"}},[3!=t.userType?a("el-col",{staticClass:"tree_box",attrs:{span:4}},[a("div",[a("el-input",{staticClass:"filter_text",attrs:{placeholder:"输入关键字进行过滤"},model:{value:t.filterText,callback:function(e){t.filterText=e},expression:"filterText"}}),t._v(" "),a("el-tree",{ref:"tree",attrs:{data:t.Treedata,props:t.defaultProps,"render-content":t.renderContent,"highlight-current":"","filter-node-method":t.filterNode},on:{"node-click":t.handleNodeClick}})],1)]):t._e(),t._v(" "),a("el-col",{staticStyle:{height:"100%"},attrs:{span:20}},[a("div",{staticClass:"top"},[a("div",[t._v("\n                 姓名："),a("el-input",{model:{value:t.username,callback:function(e){t.username=e},expression:"username"}}),t._v(" \n                时间筛选："),a("el-date-picker",{staticClass:"picker",attrs:{type:"date",placeholder:"选择开始日期时间","picker-options":t.expireTimeOptionStart},model:{value:t.startTime,callback:function(e){t.startTime=e},expression:"startTime"}}),t._v(" -\n                "),a("el-date-picker",{staticClass:"picker",attrs:{type:"date","picker-options":t.expireTimeOptionEnd,placeholder:"选择结束日期时间"},model:{value:t.endTime,callback:function(e){t.endTime=e},expression:"endTime"}}),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.seach}},[t._v(" 查询")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.handleReset}},[t._v("重置")]),t._v(" "),a("el-button",{attrs:{type:"primary",disabled:t.addFalg||t.fileLoading},on:{click:t.exportList}},[t._v(" 导出")]),t._v(" "),a("span",{staticClass:"online"},[t._v("当天巡检数:"+t._s(t.todayCount))])],1)]),t._v(" "),a("div",{staticStyle:{"margin-top":"10px",height:"88%",position:"relative"}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.fileLoading,expression:"fileLoading"}],staticStyle:{width:"150"},attrs:{data:t.tableData,border:""}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),t._v(" "),a("el-table-column",{attrs:{prop:"unitName",label:"单位名称",width:"250"}}),t._v(" "),a("el-table-column",{attrs:{prop:"checkName",label:"检查人员",width:"250"}}),t._v(" "),a("el-table-column",{attrs:{prop:"checkTotal",label:"检查总数",width:"100"}}),t._v(" "),a("el-table-column",{attrs:{prop:"exceptionTotal",label:"异常总数",width:"100"}}),t._v(" "),a("el-table-column",{attrs:{prop:"checkTime",label:"检查时间",width:"250"}}),t._v(" "),a("el-table-column",{attrs:{label:"操作"}})],1),t._v(" "),a("div",{staticClass:"page",staticStyle:{position:"absolute",bottom:"0"}},[a("pagination",{ref:"paginations",attrs:{total:t.total},on:{pageChange:t.pageChange}})],1)],1)])],1)],1)},staticRenderFns:[]};var r=a("VU/8")(s,o,!1,function(t){a("Zk5V")},null,null);e.default=r.exports},Zk5V:function(t,e){}});