webpackJsonp([10],{"/ppg":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("woOf"),r=a.n(i),l={data:function(){var e=this;return{peopleOptions:[],unitOptions:[],userType:"",Treedata:[],tableData:[],total:0,pageSize:10,pageNum:1,unitType:-1,unitId:"",filterText:"",treedefaultProps:{children:"children",label:"label"},smsPhoneTypeData:[{name:"全部",value:""},{name:"短信",value:"1"},{name:"电话",value:"2"}],type:"",smsPhoneTotal:"",startEndTime:"",smsPhoneVisible:!1,ruleForm:{smsOpen:"0",vmsOpen:"0",maxSmsCount:"",maxVmsCount:"",smsStartTime:"",smsEndTime:"",vmsStartTime:"",vmsEndTime:"",alarmMoreMinute:2,alarmMoreCount:5,alarmIntervalTime:15,testStartTime:"",testEndTime:"",resetLateDefaultTime:1,receiveAlarmUnitIds:[],delayTime:1,notificationVo:[],notificationUserList:[],unitId:"",notificationUids:[]},rule:{smsTime:[{validator:function(t,a,i){if(e.ruleForm.smsStartTime||e.ruleForm.smsEndTime)if(e.ruleForm.smsEndTime&&e.ruleForm.smsStartTime){var r=new Date(e.ruleForm.smsStartTime),l=new Date(e.ruleForm.smsEndTime);r.getTime()<l.getTime()?i():i(new Error("开始时间不能大于结束时间"))}else i();else i()},trigger:"blur"}],vmsTime:[{validator:function(t,a,i){if(e.ruleForm.vmsStartTime||e.ruleForm.vmsEndTime)if(e.ruleForm.vmsEndTime&&e.ruleForm.vmsStartTime){var r=new Date(e.ruleForm.vmsStartTime),l=new Date(e.ruleForm.vmsEndTime);r.getTime()<l.getTime()?i():i(new Error("开始时间不能大于结束时间"))}else i();else i()},trigger:"blur"}],notificationUids:[{required:!0,message:"请选择人员",trigger:"blur"}],receiveAlarmUnitIds:[{required:!0,message:"请选择单位",trigger:"blur"}],notificationUserList:[{validator:function(e,t,a){if(t){var i=/^0\d{2,3}-\d{7,8}$/,r=/^1[3|5|8|4|6|7|9]\d{9}$/,l=!1;t.map(function(e){i.test(e.notificationPhone)||r.test(e.notificationPhone)||(l=!0)}),l?a(new Error("请确认手机格式")):a()}else a(new Error("请输入联系方式"))},required:!0,trigger:"blur"}]},pickerOptions:{shortcuts:[{text:"最近一周",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-6048e5),e.$emit("pick",[a,t])}},{text:"最近一个月",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-2592e6),e.$emit("pick",[a,t])}},{text:"最近三个月",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-7776e6),e.$emit("pick",[a,t])}}]},timer:""}},components:{pagination:a("MCsY").a},methods:{peopleChange:function(e){var t=this;clearTimeout(this.timer),e.length?this.timer=setTimeout(function(){t.axios({url:"/api/admin/user/select/list",method:"post",data:{uids:e}}).then(function(e){0==e.data.code?t.ruleForm.notificationUserList=e.data.data.notificationUserList:t.$alert(e.data.msg,"提示",{confirmButtonText:"OK"})})},1500):this.ruleForm.notificationUserList=[]},pageChange:function(e){this.pageNum=e.page_index,this.pageSize=e.page_limit,this.getData()},getData:function(){var e=this,t=this,a="",i="";""!=this.startEndTime&&(a=this.startEndTime[0],i=this.startEndTime[1]),this.axios({url:"/api/admin/sms/send/record/list",method:"post",data:{pageNum:this.pageNum,pageSize:this.pageSize,unitId:this.unitId,type:this.type,startTime:a,endTime:i}}).then(function(a){if(0==a.data.code){for(var i in t.tableData=a.data.list,t.tableData)t.tableData[i].createdTime=e.$moment(t.tableData[i].createdTime).format("YYYY-MM-DD HH:mm"),1==t.tableData[i].type?t.tableData[i].typeName="短信":t.tableData[i].typeName="电话";t.total=a.data.total}else t.$alert(a.data.msg,"提示",{confirmButtonText:"OK"})})},handleNodeClick:function(e){this.unitId=e.id,this.unitType=e.type,this.pageSize=10,this.pageNum=1,this.getData()},filterNode:function(e,t){return!e||-1!==t.label.indexOf(e)},renderContent:function(e,t){var a=t.node;return e("span",[e("i",{class:t.data.icon})," ",e("span",[a.label])])},getTree:function(){var e=this;this.axios({url:"/api/admin/unit/list.left",method:"post",data:{pageNum:1,pageSize:1e3}}).then(function(t){0==t.data.code?t.data.data&&(e.Treedata=t.data.data):e.$alert(t.data.msg,"提示",{confirmButtonText:"OK"})})},openSmsPhone:function(){var e=this,t=this;this.axios({url:"/api/admin/sms/config/single",method:"post",data:{id:this.unitId}}).then(function(a){0==a.data.code?(null!=a.data.data&&(t.ruleForm=a.data.data,t.ruleForm.smsOpen=String(t.ruleForm.smsOpen),t.ruleForm.vmsOpen=String(t.ruleForm.vmsOpen)),e.getOptions()):t.$alert(a.data.msg,"提示",{confirmButtonText:"OK"})}),this.smsPhoneVisible=!0},getOptions:function(){var e=this;this.axios({url:"/api/admin/unit/list",method:"post",data:{pageNum:1,pageSize:99999,unitId:this.unitId}}).then(function(t){e.unitOptions=t.data.list}),this.axios({url:"/api/admin/user/list",method:"post",data:{pageNum:1,pageSize:99999,unitId:this.unitId}}).then(function(t){e.peopleOptions=t.data.list})},closeSmsPhone:function(){this.smsPhoneVisible=!1,r()(this.$data.ruleForm,this.$options.data().ruleForm)},handleSubmit:function(e){var t=this,a=this;this.$refs[e].validate(function(e){e&&(t.ruleForm.unitId=t.unitId,t.axios({url:"/api/admin/sms/config",method:"post",data:t.ruleForm}).then(function(e){0==e.data.code?a.$alert("设置成功","提示",{confirmButtonText:"OK",callback:function(){a.closeSmsPhone()}}):a.$alert(e.data.msg,"提示",{confirmButtonText:"OK"})}))})},search:function(){this.pageNum=1,this.$refs.paginationChild.changePageNum(this.pageNum),this.getData()},resetSearch:function(){this.startEndTime="",this.type="",this.getData()}},mounted:function(){this.getTree(),this.userType=sessionStorage.getItem("userTypes"),3==this.userType&&(this.unitType=1),this.unitId=Number(sessionStorage.getItem("unitId"))},watch:{filterText:function(e){this.$refs.tree.filter(e)}}},n={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"SMSphoneStatistics allcontent"},[3!=e.userType?a("el-col",{staticClass:"tree_box",attrs:{span:4}},[a("div",[a("el-input",{staticClass:"filter_text",attrs:{placeholder:"输入关键字进行过滤"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),e._v(" "),a("el-tree",{ref:"tree",attrs:{data:e.Treedata,props:e.treedefaultProps,"render-content":e.renderContent,"highlight-current":"","filter-node-method":e.filterNode},on:{"node-click":e.handleNodeClick}})],1)]):e._e(),e._v(" "),a("el-col",{staticStyle:{height:"100%"},attrs:{span:3==e.userType?24:20}},[a("div",{staticClass:"top"},[e._v("\n            开始结束时间:\n            "),a("el-date-picker",{attrs:{type:"datetimerange","picker-options":e.pickerOptions,"range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",align:"right"},model:{value:e.startEndTime,callback:function(t){e.startEndTime=t},expression:"startEndTime"}}),e._v("\n             \n            类型: "),a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.type,callback:function(t){e.type=t},expression:"type"}},e._l(e.smsPhoneTypeData,function(e){return a("el-option",{key:e.value,attrs:{label:e.name,value:e.value}})}),1),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.search}},[e._v("查询")]),e._v(" "),a("el-button",{on:{click:e.resetSearch}},[e._v("重置")]),e._v(" "),0==e.unitType||1==e.unitType?[a("el-button",{attrs:{type:"success"},on:{click:e.openSmsPhone}},[e._v("短信电话发送设置")])]:e._e()],2),e._v(" "),a("div",{staticClass:"bottom"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"",height:"600"}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{prop:"createdTime",label:"时间",width:"150"}}),e._v(" "),a("el-table-column",{attrs:{prop:"typeName",label:"类型",width:"100"}}),e._v(" "),a("el-table-column",{attrs:{prop:"caller",label:"主叫号码",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"callee",label:"被叫号码",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"duration",label:"通话时间",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" \n                            "+e._s(t.row.duration&&t.row.duration||0)+" s\n                        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"ringTime",label:"响铃时间",width:"160"}}),e._v(" "),a("el-table-column",{attrs:{prop:"originateTime",label:"呼叫发起时间",width:"160"}}),e._v(" "),a("el-table-column",{attrs:{prop:"startTime",label:"接通开始时间",width:"160"}}),e._v(" "),a("el-table-column",{attrs:{prop:"endTime",label:"通话结束时间",width:"160"}}),e._v(" "),a("el-table-column",{attrs:{prop:"duration",label:"是否接通",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" \n                        "+e._s(t.row.duration?"接通":"未接通")+"\n                    ")]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"content",label:"内容",width:"450"}})],1),e._v(" "),a("div",{staticClass:"page_all"},[a("pagination",{ref:"paginationChild",attrs:{total:e.total},on:{pageChange:e.pageChange}})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"设置",visible:e.smsPhoneVisible,"before-close":e.closeSmsPhone},on:{"update:visible":function(t){e.smsPhoneVisible=t}}},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rule,"label-width":"152px"}},[a("el-form-item",{attrs:{label:"短信"}},[a("el-radio",{attrs:{label:"1"},model:{value:e.ruleForm.smsOpen,callback:function(t){e.$set(e.ruleForm,"smsOpen",t)},expression:"ruleForm.smsOpen"}},[e._v("开启")]),e._v(" "),a("el-radio",{attrs:{label:"0"},model:{value:e.ruleForm.smsOpen,callback:function(t){e.$set(e.ruleForm,"smsOpen",t)},expression:"ruleForm.smsOpen"}},[e._v("关闭")])],1),e._v(" "),a("el-form-item",{attrs:{label:"电话"}},[a("el-radio",{attrs:{label:"1"},model:{value:e.ruleForm.vmsOpen,callback:function(t){e.$set(e.ruleForm,"vmsOpen",t)},expression:"ruleForm.vmsOpen"}},[e._v("开启")]),e._v(" "),a("el-radio",{attrs:{label:"0"},model:{value:e.ruleForm.vmsOpen,callback:function(t){e.$set(e.ruleForm,"vmsOpen",t)},expression:"ruleForm.vmsOpen"}},[e._v("关闭")])],1),e._v(" "),a("el-form-item",{attrs:{label:"月最大短信发送量"}},[a("el-input",{attrs:{placeholder:"默认无限量"},model:{value:e.ruleForm.maxSmsCount,callback:function(t){e.$set(e.ruleForm,"maxSmsCount",t)},expression:"ruleForm.maxSmsCount"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"月最大电话拨打量"}},[a("el-input",{attrs:{placeholder:"默认无限量"},model:{value:e.ruleForm.maxVmsCount,callback:function(t){e.$set(e.ruleForm,"maxVmsCount",t)},expression:"ruleForm.maxVmsCount"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"接收报警单位",prop:"receiveAlarmUnitIds"}},[a("el-select",{attrs:{filterable:"",multiple:"",placeholder:"请选择单位"},model:{value:e.ruleForm.receiveAlarmUnitIds,callback:function(t){e.$set(e.ruleForm,"receiveAlarmUnitIds",t)},expression:"ruleForm.receiveAlarmUnitIds"}},e._l(e.unitOptions,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"通知人员",prop:"notificationUids"}},[a("el-select",{attrs:{filterable:"",multiple:""},on:{change:e.peopleChange},model:{value:e.ruleForm.notificationUids,callback:function(t){e.$set(e.ruleForm,"notificationUids",t)},expression:"ruleForm.notificationUids"}},e._l(e.peopleOptions,function(e){return a("el-option",{key:e.id,attrs:{label:e.username,value:e.id}})}),1)],1),e._v(" "),e._l(e.ruleForm.notificationUserList,function(t,i){return t.notificationUid?a("el-form-item",{key:t.notificationUid,attrs:{label:t.notificationUname,prop:"notificationUserList"}},[a("el-input",{model:{value:t.notificationPhone,callback:function(a){e.$set(t,"notificationPhone",a)},expression:"item.notificationPhone"}})],1):e._e()}),e._v(" "),a("el-form-item",{attrs:{label:"报警延迟时间",prop:"delayTime"}},[a("el-input",{model:{value:e.ruleForm.delayTime,callback:function(t){e.$set(e.ruleForm,"delayTime",t)},expression:"ruleForm.delayTime"}}),e._v(" 分\n                ")],1),e._v(" "),a("el-form-item",{attrs:{label:"多报警信息通知时间"}},[a("el-input",{model:{value:e.ruleForm.alarmMoreMinute,callback:function(t){e.$set(e.ruleForm,"alarmMoreMinute",t)},expression:"ruleForm.alarmMoreMinute"}}),e._v(" 分\n                ")],1),e._v(" "),a("el-form-item",{attrs:{label:"多报警信息通知条数"}},[a("el-input",{model:{value:e.ruleForm.alarmMoreCount,callback:function(t){e.$set(e.ruleForm,"alarmMoreCount",t)},expression:"ruleForm.alarmMoreCount"}}),e._v(" 条\n                ")],1),e._v(" "),a("el-form-item",{attrs:{label:"同一点位报警间隔时间"}},[a("el-input",{model:{value:e.ruleForm.alarmIntervalTime,callback:function(t){e.$set(e.ruleForm,"alarmIntervalTime",t)},expression:"ruleForm.alarmIntervalTime"}}),e._v(" 分\n                ")],1),e._v(" "),a("el-form-item",{attrs:{label:"复位后通知时间"}},[a("el-input",{model:{value:e.ruleForm.resetLateDefaultTime,callback:function(t){e.$set(e.ruleForm,"resetLateDefaultTime",t)},expression:"ruleForm.resetLateDefaultTime"}}),e._v(" 分\n                ")],1),e._v(" "),a("el-form-item",{attrs:{label:"允许短信发送时间",prop:"smsTime"}},[a("el-time-picker",{attrs:{format:"HH:mm",placeholder:"默认全天"},model:{value:e.ruleForm.smsStartTime,callback:function(t){e.$set(e.ruleForm,"smsStartTime",t)},expression:"ruleForm.smsStartTime"}}),e._v(" - \n                    "),a("el-time-picker",{attrs:{format:"HH:mm",placeholder:"默认全天"},model:{value:e.ruleForm.smsEndTime,callback:function(t){e.$set(e.ruleForm,"smsEndTime",t)},expression:"ruleForm.smsEndTime"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"允许电话拨打时间",prop:"vmsTime"}},[a("el-time-picker",{attrs:{format:"HH:mm",placeholder:"默认全天"},model:{value:e.ruleForm.vmsStartTime,callback:function(t){e.$set(e.ruleForm,"vmsStartTime",t)},expression:"ruleForm.vmsStartTime"}}),e._v(" -\n                    "),a("el-time-picker",{attrs:{format:"HH:mm",placeholder:"默认全天"},model:{value:e.ruleForm.vmsEndTime,callback:function(t){e.$set(e.ruleForm,"vmsEndTime",t)},expression:"ruleForm.vmsEndTime"}})],1),e._v(" "),a("el-form-item",{staticClass:"formfooter"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleSubmit("ruleForm")}}},[e._v("立即提交")]),e._v(" "),a("el-button",{on:{click:e.closeSmsPhone}},[e._v("取 消")])],1)],2)],1)],1)],1)},staticRenderFns:[]};var o=a("VU/8")(l,n,!1,function(e){a("yyYp")},"data-v-feff3dac",null);t.default=o.exports},yyYp:function(e,t){}});