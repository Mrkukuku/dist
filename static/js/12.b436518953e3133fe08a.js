webpackJsonp([12],{iaX4:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("g5qz"),r=a("MCsY"),l={mixins:[i.a],components:{pagination:r.a},data:function(){var e=this;return{module:"phone",addFalg:!0,userType:sessionStorage.getItem("userTypes"),companyId:sessionStorage.getItem("unitId"),staffName:"",equmentList:[],deviceIdList:[],props:{multiple:!0},options:[{type:"",desc:""}],currentPage:1,rows:10,total:1,ruleForm:{id:null,unitId:"",staffName:"",phone:"",startTime:"",endTime:"",deviceIdList:[]},rules:{staffName:[{required:!0,message:"请输入员工姓名",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1\d{10}$/,message:"手机格式不正确",trigger:"blur"}],startTime:[{required:!0,validator:function(t,a,i){""===a?i(new Error("请选择开始时间")):e.ruleForm.endTime&&a>e.ruleForm.endTime?i(new Error("结束时间要在开始时间之前，请重新选择时间!")):i()},trigger:"blur"}],endTime:[{validator:function(t,a,i){""===a?i(new Error("请选择结束时间")):a<e.ruleForm.startTime?i(new Error("结束时间在开始时间之前，请重新选择!")):i()},required:!0,trigger:"blur"}]},data:[{children:[{label:"江干"}],label:"城市"},{children:[{label:"江干1"}],label:"城市1"}],defaultProps:{children:"children",label:"label"},expireTimeOptionStart:{disabledDate:function(e){return e.getTime()+864e5<Date.now()}},expireTimeOptionEnd:{disabledDate:function(t){var a=e.ruleForm.startTime;if(a)return t.getTime()<new Date(a).getTime()}}}},methods:{filterNode:function(e,t){return!e||-1!==t.label.indexOf(e)},searchmaillist:function(){var e=this;this.currentPage=1,this.$refs.paginationChild.changePageNum(this.currentPage),this.axios({url:"/api/admin/phone/list",method:"post",data:{unitId:this.companyId,pageSize:this.rows,pageNum:this.currentPage,staffName:this.staffName}}).then(function(t){0==t.data.code?(e.tableData=t.data.list,e.total=t.data.total,e.currentPage=t.data.pageNum,e.tableData.map(function(t){t.startTime=t.startTime&&e.$moment(t.startTime).format("YYYY-MM-DD HH:mm")||"",t.endTime=t.endTime&&e.$moment(t.endTime).format("YYYY-MM-DD HH:mm")||""})):e.$alert(t.data.msg,"提示",{confirmButtonText:"OK"})})},resetmaillist:function(){this.staffName="",this.searchmaillist()},resetForm:function(){this.ruleForm.staffName="",this.ruleForm.phone="",this.ruleForm.startTime="",this.ruleForm.endTime="",this.ruleForm.deviceIdList=[],this.deviceIdList=[]},renderContent:function(e,t){var a=t.node;return e("span",[e("i",{class:t.data.icon})," ",e("span",[a.label])])},handleNodeClick:function(e){this.companyId=e.id,this.ruleForm.unitId=e.id,this.addFalg=!1,this.rows=10,this.currentPage=1,this.getData(),this.getequmentList()},getequmentList:function(){var e=this;this.axios({url:"/api/admin/phone/deviceList",method:"post",data:{id:this.companyId}}).then(function(t){0==t.data.code?e.equmentList=t.data.data:e.$alert(t.data.msg,"提示",{confirmButtonText:"OK"})})},pageChange:function(e){this.currentPage=e.page_index,this.rows=e.page_limit,this.getData()}},created:function(){this.ruleForm.unitId=Number(sessionStorage.getItem("unitId")),this.companyId=Number(sessionStorage.getItem("unitId"))}},s={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"allcontent",attrs:{id:"maillist"}},[a("el-row",{staticStyle:{height:"100%"}},[3!=e.userType?a("el-col",{staticClass:"tree_box",attrs:{span:4}},[a("div",[a("el-input",{staticClass:"filter_text",attrs:{placeholder:"输入关键字进行过滤"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),e._v(" "),a("el-tree",{ref:"tree",attrs:{data:e.Treedata,props:e.defaultProps,"render-content":e.renderContent,"highlight-current":"","filter-node-method":e.filterNode},on:{"node-click":e.handleNodeClick}})],1)]):e._e(),e._v(" "),a("el-col",{staticStyle:{"padding-left":"10px",height:"100%"},attrs:{span:20}},[a("div",[a("div",{staticClass:"top"},[e._v("\n                            员工姓名:\n                            "),a("el-input",{model:{value:e.staffName,callback:function(t){e.staffName=t},expression:"staffName"}}),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.searchmaillist}},[e._v("查询")]),e._v(" "),a("el-button",{on:{click:e.resetmaillist}},[e._v("重置")]),e._v(" "),3==e.userType?[a("el-button",{attrs:{type:"primary"},on:{click:e.opendialog}},[a("i",{staticClass:"el-icon-plus"}),e._v(" 新增")])]:[a("el-button",{attrs:{type:"primary",disabled:e.addFalg},on:{click:e.opendialog}},[a("i",{staticClass:"el-icon-plus"}),e._v(" 新增")])]],2)]),e._v(" "),a("div",{staticStyle:{"margin-top":"10px",height:"88%",position:"relative"}},[a("el-table",{staticStyle:{width:"150"},attrs:{data:e.tableData,border:""}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{prop:"staffName",label:"员工姓名",width:"200"}}),e._v(" "),a("el-table-column",{attrs:{prop:"phone",label:"联系电话",width:"250"}}),e._v(" "),a("el-table-column",{attrs:{prop:"startTime",label:"开始时间",width:"270"}}),e._v(" "),a("el-table-column",{attrs:{prop:"endTime",label:"结束时间",width:"270"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticClass:"el-icon-edit",attrs:{size:"mini",type:"primary"},on:{click:function(a){return e.editData(t.row.id)}}},[e._v("编辑")]),e._v(" "),a("el-button",{staticClass:"el-icon-delete",attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.handleDelete(t.row.id)}}},[e._v("删除")])]}}])})],1),e._v(" "),a("div",{staticStyle:{position:"absolute",bottom:"0"}},[a("pagination",{ref:"paginationChild",attrs:{total:e.total},on:{pageChange:e.pageChange}})],1)],1)])],1),e._v(" "),a("el-dialog",{staticClass:"dialog",attrs:{title:"添加修改人员信息",visible:e.dialogVisible,width:"30%","close-on-click-modal":!1,"before-close":e.closedialog},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"员工姓名",prop:"staffName"}},[a("el-input",{staticClass:"picker",model:{value:e.ruleForm.staffName,callback:function(t){e.$set(e.ruleForm,"staffName",t)},expression:"ruleForm.staffName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"手机号",prop:"phone"}},[a("el-input",{staticClass:"picker",model:{value:e.ruleForm.phone,callback:function(t){e.$set(e.ruleForm,"phone",t)},expression:"ruleForm.phone"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"设备集合",prop:"deviceIdList"}},[a("el-cascader",{attrs:{options:e.equmentList,props:e.props,"collapse-tags":"",filterable:"",clearable:""},model:{value:e.deviceIdList,callback:function(t){e.deviceIdList=t},expression:"deviceIdList"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"开始时间",prop:"startTime"}},[a("el-date-picker",{staticClass:"picker",attrs:{type:"datetime",placeholder:"选择开始日期时间","picker-options":e.expireTimeOptionStart,"default-time":"12:00:00"},model:{value:e.ruleForm.startTime,callback:function(t){e.$set(e.ruleForm,"startTime",t)},expression:"ruleForm.startTime"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"结束时间",prop:"endTime"}},[a("el-date-picker",{staticClass:"picker",attrs:{type:"datetime","picker-options":e.expireTimeOptionEnd,placeholder:"选择结束日期时间","default-time":"12:00:00"},model:{value:e.ruleForm.endTime,callback:function(t){e.$set(e.ruleForm,"endTime",t)},expression:"ruleForm.endTime"}})],1),e._v(" "),a("el-form-item",{staticClass:"submitagency formfooter"},[a("el-button",{directives:[{name:"noMoreClick",rawName:"v-noMoreClick"}],attrs:{type:"primary"},on:{click:function(t){return e.handleSubmit("ruleForm")}}},[e._v("立即提交")]),e._v(" "),a("el-button",{on:{click:e.closedialog}},[e._v("取 消")])],1)],1)],1)],1)},staticRenderFns:[]};var o=a("VU/8")(l,s,!1,function(e){a("pDZi")},null,null);t.default=o.exports},pDZi:function(e,t){}});