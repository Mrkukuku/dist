webpackJsonp([43],{I6fG:function(e,t){},KOar:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("woOf"),i=a.n(r),n={components:{pagination:a("MCsY").a},data:function(){return{userType:"",areaName:"",tableData:[],pageNum:1,pageSize:10,total:200,transfer:!1,transfer_title:["未关联的单位列表","已关联的单位列表"],data:[],transferValue:[],filterText:"",Treedata:[],unitId:"",addAreaFlag:!0,treedefaultProps:{children:"children",label:"label"},filterMethod:function(e,t){return t.initial.indexOf(e)>-1},ruleForm:{areaName:"",movekeys:[],delete:[]},rules:{areaName:[{required:!0,message:"请输入区域名称",trigger:"blur"}]},singleData:[]}},methods:{changeTransfer:function(e,t,a){if("left"==t){for(var r in a){for(var i in this.ruleForm.movekeys)a[r]==this.ruleForm.movekeys[i]&&this.ruleForm.movekeys.splice(i,1);for(var n in this.singleData)a[r]==this.singleData[n]&&this.ruleForm.delete.push(a[r])}console.log("left"),console.log(this.ruleForm.delete),console.log(this.ruleForm.movekeys)}else{for(var r in a){for(var i in this.ruleForm.delete)a[r]==this.ruleForm.delete[i]&&this.ruleForm.delete.splice(i,1);if(this.ruleForm.id){var l=0;for(var n in this.singleData)a[r]==this.singleData[n]&&(l=1);1!=l&&this.ruleForm.movekeys.push(a[r])}else this.ruleForm.movekeys.push(a[r])}console.log("right"),console.log(this.ruleForm.delete),console.log(this.ruleForm.movekeys)}},SperRela:function(e){this.getSingle(e),this.ruleForm.movekeys=[],this.ruleForm.delete=[]},getSingle:function(e){var t=this;t.singleData=[],this.axios({url:"/api/admin/area/manager/unit/detail",method:"post",data:{id:e}}).then(function(e){0==e.data.code?(t.ruleForm.areaName=e.data.data.areaName,t.ruleForm.id=e.data.data.id,t.singleData=e.data.data.unitIds,t.getTranfer(e.data.data.unitIds)):t.$alert(e.data.msg,"提示",{confirmButtonText:"OK"})})},getTranfer:function(e){this.data=[],this.transferValue=[];var t=this;t.initials=[],this.axios({url:"api/admin/unit/sub/ids",method:"post",data:{id:this.unitId}}).then(function(a){if(0==a.data.code){for(var r=a.data.data.children,i=0;i<r.length;i++)t.initials.push(r[i].label),t.data.push({label:r[i].label,key:r[i].value,initial:t.initials[i]});e&&(t.transferValue=e,t.transfer=!0)}})},Closetransfer:function(){this.transfer=!1,delete this.ruleForm.id,i()(this.$data.ruleForm,this.$options.data().ruleForm)},filterNode:function(e,t){return!e||-1!==t.label.indexOf(e)},renderContent:function(e,t){var a=t.node;return e("span",[e("i",{class:t.data.icon})," ",e("span",[a.label])])},handleNodeClick:function(e){this.unitId=e.id,0==e.type?this.addAreaFlag=!0:this.addAreaFlag=!1,this.getData()},searchreset:function(){this.areaName=""},searchData:function(){this.pageNum=1,this.$refs.paginationChild.changePageNum(this.pageNum),this.getData()},getTreeData:function(){var e=this;this.axios({url:"/api/admin/unit/list/left",method:"post",data:{pageNum:1e3,pageSize:1}}).then(function(t){0==t.data.code?e.Treedata=t.data.data:e.$alert(t.data.msg,"提示",{confirmButtonText:"OK"})})},openTranferBox:function(){this.transfer=!0,this.ruleForm.movekeys=[],this.ruleForm.delete=[],this.getTranfer()},handleSubmit:function(e){var t=this,a=this;this.$refs[e].validate(function(e){if(e){var r=t.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),i="/api/admin/area/manager/unit/register";t.ruleForm.id?(i="/api/admin/area/manager/unit/update",t.axios({url:i,method:"post",data:{id:t.ruleForm.id,managerUnitId:t.unitId,add:t.ruleForm.movekeys,delete:t.ruleForm.delete,areaName:t.ruleForm.areaName}}).then(function(e){r.close(),0==e.data.code?a.$alert("关联成功","提示",{confirmButtonText:"OK",callback:function(){a.Closetransfer(),a.getData()}}):a.$alert(e.data.msg,"提示",{confirmButtonText:"OK"})})):t.axios({url:i,method:"post",data:{managerUnitId:t.unitId,subUnitIds:t.ruleForm.movekeys,areaName:t.ruleForm.areaName}}).then(function(e){r.close(),0==e.data.code?a.$alert("关联成功","提示",{confirmButtonText:"OK",callback:function(){a.Closetransfer(),a.getData()}}):a.$alert(e.data.msg,"提示",{confirmButtonText:"OK"})})}})},handleReset:function(){this.ruleForm.areaName="",this.getTranfer()},getData:function(){var e=this;this.axios({url:"/api/admin/area/manager/unit/search/page",method:"post",data:{pageNum:this.pageNum,pageSize:this.pageSize,unitId:this.unitId,areaName:this.areaName}}).then(function(t){if(0==t.data.code){for(var a in e.tableData=t.data.list,e.tableData)for(var r in e.tableData[a].list="",e.tableData[a].unitNameList)e.tableData[a].list+=e.tableData[a].unitNameList[r]+" 、 ";e.total=t.data.total}else e.$alert(t.data.msg,"提示",{confirmButtonText:"OK"})})},pageChange:function(e){this.pageNum=e.page_index,this.pageSize=e.page_limit,this.getData()},deleteBox:function(e){var t=this,a=this;this.$confirm("你确定要删除吗").then(function(){t.axios({url:"/api/admin/area/manager/unit/delete",method:"post",data:{id:e}}).then(function(e){0==e.data.code?a.$alert("删除成功","提示",{confirmButtonText:"OK",callback:function(){a.getData()}}):a.$alert(e.data.msg,"提示",{confirmButtonText:"OK"})})})}},watch:{filterText:function(e){this.$refs.tree.filter(e)}},mounted:function(){this.userType=sessionStorage.getItem("userTypes"),2==this.userType?(this.unitId=sessionStorage.getItem("unitId"),this.addAreaFlag=!1):this.getTreeData(),this.getData()}},l={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"allcontent",attrs:{id:"unitAreaModule"}},[1==e.userType?a("el-col",{staticClass:"tree_box",attrs:{span:4}},[a("div",[a("el-input",{staticClass:"filter_text",attrs:{placeholder:"输入关键字进行过滤"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),e._v(" "),a("el-tree",{ref:"tree",attrs:{data:e.Treedata,props:e.treedefaultProps,"render-content":e.renderContent,"highlight-current":"","filter-node-method":e.filterNode},on:{"node-click":e.handleNodeClick}})],1)]):e._e(),e._v(" "),a("el-col",{staticStyle:{height:"100%","padding-left":"10px"},attrs:{span:20}},[a("div",{staticClass:"top"},[e._v("\n            区域名称:"),a("el-input",{attrs:{placeholder:"搜索名称"},model:{value:e.areaName,callback:function(t){e.areaName=t},expression:"areaName"}}),e._v("  \n            "),a("el-button",{attrs:{type:"primary"},on:{click:e.searchData}},[e._v("查询")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.searchreset}},[e._v("重置")]),e._v(" "),a("el-button",{attrs:{type:"primary",disabled:e.addAreaFlag},on:{click:e.openTranferBox}},[e._v("新增区域")])],1),e._v(" "),a("div",{staticClass:"bottom"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:""}},[a("el-table-column",{attrs:{prop:"areaName",label:"区域名称",width:"140"}}),e._v(" "),a("el-table-column",{attrs:{prop:"list",label:"单位集合",width:"800"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return e.SperRela(t.row.id)}}},[e._v("编辑")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return e.deleteBox(t.row.id)}}},[e._v("删除")])]}}])})],1),e._v(" "),a("div",{staticClass:"page_all"},[a("pagination",{ref:"paginationChild",attrs:{total:e.total},on:{pageChange:e.pageChange}})],1),e._v(" "),a("div",{staticClass:"dialog_transfer"},[a("el-dialog",{attrs:{title:"提示",visible:e.transfer,width:"50%","close-on-click-modal":!1,"modal-append-to-body":!1,"before-close":e.Closetransfer},on:{"update:visible":function(t){e.transfer=t}}},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{rules:e.rules,model:e.ruleForm,data:e.ruleForm,"status-icon":"","label-width":"150px"}},[a("el-form-item",{attrs:{label:"区域名称",prop:"areaName"}},[a("el-input",{model:{value:e.ruleForm.areaName,callback:function(t){e.$set(e.ruleForm,"areaName",t)},expression:"ruleForm.areaName"}})],1),e._v(" "),a("el-transfer",{attrs:{filterable:"","filter-method":e.filterMethod,"filter-placeholder":"State Abbreviations",titles:e.transfer_title,data:e.data},on:{change:e.changeTransfer},model:{value:e.transferValue,callback:function(t){e.transferValue=t},expression:"transferValue"}}),e._v(" "),a("el-form-item",{staticClass:"formfooter"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleSubmit("ruleForm")}}},[e._v("立即提交")]),e._v(" "),a("el-button",{on:{click:function(t){return e.Closetransfer()}}},[e._v("取消")])],1)],1)],1)],1)],1)])],1)},staticRenderFns:[]};var o=a("VU/8")(n,l,!1,function(e){a("I6fG")},null,null);t.default=o.exports}});