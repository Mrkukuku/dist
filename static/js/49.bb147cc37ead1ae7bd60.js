webpackJsonp([49],{LH5g:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("woOf"),r=a.n(i),l={data:function(){return{userType:"",userTypes:"",tableData:[],pageNum:1,pageSize:10,total:200,name:"",type:"",status:"",startTime:"",endTime:"",filterText:"",Treedata:[],unitId:"",addAreaFlag:!0,visibleDialog:!1,treedefaultProps:{children:"children",label:"label"},filterMethod:function(e,t){return t.initial.indexOf(e)>-1},pickerOptions:{disabledDate:function(e){return e.getTime()<Date.now()},shortcuts:[{text:"今天",onClick:function(e){e.$emit("pick",new Date)}},{text:"昨天",onClick:function(e){var t=new Date;t.setTime(t.getTime()-864e5),e.$emit("pick",t)}},{text:"一周前",onClick:function(e){var t=new Date;t.setTime(t.getTime()-6048e5),e.$emit("pick",t)}}]},ruleForm:{name:"",unitId:"",endTime:"",chargeId:"",type:"2",address:"",content:"",planPersonNum:""},rules:{name:[{required:!0,message:"请输入演练任务名称",trigger:"blur"}],unitId:[{required:!0,message:"请选择演练单位",trigger:"blur"}],chargeId:[{required:!0,message:"请选择演练负责人",trigger:"blur"}],type:[{required:!0,message:"请选择演练类型",trigger:"blur"}],endTime:[{required:!0,message:"请选择演练时间",trigger:"blur"}],address:[{required:!0,message:"请输入演练地点",trigger:"blur"}],content:[{required:!0,message:"请输入演练描述",trigger:"blur"}],planPersonNum:[{required:!0,message:"请输入预计参加人数",trigger:"blur"},{pattern:/^\d{1,9}$/,message:"必须为数字",trigger:"blur"}]},unitIdData:[],userData:[],typeData:[{name:"单项演练",id:"1"},{name:"综合演练",id:"2"}],statusData:[{name:"未完成",id:"0"},{name:"已完成",id:"1"}],visibleReply:!1,replyForm:{actualPersonNum:"",content:""},replyRules:{actualPersonNum:[{required:!0,message:"请输入演练任务实际参加人数",trigger:"blur"},{pattern:/^\d{1,9}$/,message:"必须为数字",trigger:"blur"}],content:[{required:!0,message:"请输入演练任务描述",trigger:"blur"}]},replyPhotoVisible:!1,dialogImageUrl:"",replyPhotoList:[],selectReplySingleDialog:!1,ReplySingleData:[]}},components:{pagination:a("MCsY").a},methods:{SperRela:function(e){this.getSingle(e)},getSingle:function(e){var t=this;this.axios({url:"api/admin/manoeuvre/single",method:"post",data:{id:e}}).then(function(e){0==e.data.code?(t.ruleForm=e.data.data,t.ruleForm.type=String(t.ruleForm.type),t.openDialog(),t.getUserData()):t.$alert(e.data.msg,"提示",{confirmButtonText:"OK"})})},Closetransfer:function(){this.visibleDialog=!1,delete this.ruleForm.id,r()(this.$data.ruleForm,this.$options.data().ruleForm)},openDialog:function(){2==this.userType?this.getUnitIdData():3==this.userType&&(this.ruleForm.unitId=sessionStorage.getItem("unitId"),this.getUserData()),1==this.userType&&(2==this.userTypes?this.getUnitIdData():(this.ruleForm.unitId=this.unitId,this.getUserData())),this.visibleDialog=!0},filterNode:function(e,t){return!e||-1!==t.label.indexOf(e)},renderContent:function(e,t){var a=t.node;return e("span",[e("i",{class:t.data.icon})," ",e("span",[a.label])])},handleNodeClick:function(e){this.unitId=e.id,this.userTypes=Number(e.type)+2,2!=this.userTypes&&3!=this.userTypes||(this.addAreaFlag=!1),this.getData()},searchreset:function(){this.name="",this.type="",this.status="",this.startTime="",this.endTime="",this.getData()},pageChange:function(e){this.pageNum=e.page_index,this.pageSize=e.page_limit,this.getData()},searchData:function(){this.pageNum=1,this.$refs.paginationChild.changePageNum(this.pageNum),this.getData()},getTreeData:function(){var e=this;this.axios({url:"/api/admin/unit/list.left",method:"post",data:{pageNum:1e3,pageSize:1}}).then(function(t){0==t.data.code?e.Treedata=t.data.data:e.$alert(t.data.msg,"提示",{confirmButtonText:"OK"})})},handleSubmit:function(e){var t=this,a=this;this.$refs[e].validate(function(e){if(e){t.ruleForm.managerUnitId=t.unitId;var i="/api/admin/manoeuvre/add";t.ruleForm.id&&(i="/api/admin/manoeuvre/update"),t.axios({url:i,method:"post",data:t.ruleForm}).then(function(e){0==e.data.code?a.$alert("保存成功","提示",{confirmButtonText:"OK",callback:function(){a.Closetransfer(),a.getData()}}):a.$alert(e.data.msg,"提示",{confirmButtonText:"OK"})})}})},getData:function(){var e=new Date(this.startTime),t=new Date(this.endTime);if(""==this.startTime&&""==this.endTime||e.getTime()<=t.getTime()){var a=this;this.axios({url:"/api/admin/manoeuvre/list",method:"post",data:{pageNum:this.pageNum,pageSize:this.pageSize,unitId:this.unitId,name:this.name,type:this.type,status:this.status,startTime:this.startTime,endTime:this.endTime}}).then(function(e){if(0==e.data.code){for(var t in a.tableData=e.data.list,a.tableData)0==a.tableData[t].status?a.tableData[t].statusCh="未完成":a.tableData[t].statusCh="已完成",1==a.tableData[t].type?a.tableData[t].typeName="单项演练":a.tableData[t].typeName="综合演练",a.tableData[t].endTime=a.$moment(a.tableData[t].endTime).format("YYYY-MM-DD");a.total=e.data.total}else a.$alert(e.data.msg,"提示",{confirmButtonText:"OK"})})}else this.$message.error("开始时间不能小于结束时间")},deleteBox:function(e){var t=this,a=this;this.$confirm("你确定要删除吗").then(function(){t.axios({url:"/api/admin/manoeuvre/delete",method:"post",data:{id:e}}).then(function(e){0==e.data.code?a.$alert("删除成功","提示",{confirmButtonText:"OK",callback:function(){a.getData()}}):a.$alert(e.data.msg,"提示",{confirmButtonText:"OK"})})})},getUnitIdData:function(){var e=this;this.axios({url:"/api/admin/unit/list",method:"post",data:{unitId:this.unitId,pageNum:1,pageSize:1e3}}).then(function(t){0==t.data.code?(e.unitIdData=t.data.list,e.unitIdData.splice(0,1)):e.$alert(t.data.msg,"提示",{confirmButtonText:"OK"})})},changeUnit:function(){this.ruleForm.chargeId="",this.getUserData()},getUserData:function(){var e=this;this.axios({url:"/api/admin/user/list",method:"post",data:{unitId:this.ruleForm.unitId,pageNum:1,pageSize:1e3}}).then(function(t){0==t.data.code?e.userData=t.data.list:e.$alert(t.data.msg,"提示",{confirmButtonText:"OK"})})},searchBox:function(e){var t=this;this.axios({url:"/api/admin/manoeuvre/patrol/search",method:"post",data:{id:e}}).then(function(e){0==e.data.code?e.data.data?(t.selectReplySingleDialog=!0,t.ReplySingleData=e.data.data,t.ReplySingleData.imgUrlData=t.ReplySingleData.imgUrl&&t.ReplySingleData.imgUrl.split(",")||[]):t.$alert("该任务还没有完成，没有反馈数据","提示",{confirmButtonText:"OK"}):t.$alert(e.data.msg,"提示",{confirmButtonText:"OK"})})},CloseReply:function(){this.visibleReply=!1,r()(this.$data.replyForm,this.$options.data().replyForm),delete this.replyForm.manoeuvreId,this.replyPhotoList=[],document.querySelector(".replyPhoto ul").innerHTML=""},openSubmitBox:function(e){this.visibleReply=!0,this.replyForm.manoeuvreId=e},handlePictureCardPreview:function(e){this.dialogImageUrl=e.url,this.replyPhotoVisible=!0},replyPhotoSubmit:function(e){var t=this,a=this,i=new FormData;i.append("file",e.file),i.append("fileType",8),this.axios({url:"/api/admin/file/upload",method:"post",data:i}).then(function(i){0==i.data.code?(a.replyPhotoList.push({img:i.data.data.fileUrl,uid:e.file.uid}),t.$message({message:"上传成功",type:"success"})):a.$alert(i.data.msg,"提示",{confirmButtonText:"OK"})})},handleRemove:function(e,t){for(var a in this.replyPhotoList)this.replyPhotoList[a].uid==e.uid&&this.replyPhotoList.splice(a,1)},SubmitReply:function(){var e=this;for(var t in this.replyForm.chargeId=sessionStorage.getItem("user_id"),this.replyForm.unitId=sessionStorage.getItem("unitId"),this.replyForm.list=[],this.replyPhotoList)this.replyForm.list.push(this.replyPhotoList[t].img);this.axios({url:"/api/admin/manoeuvre/submit",method:"post",data:this.replyForm}).then(function(t){0==t.data.code?e.$alert("保存成功","提示",{confirmButtonText:"OK",callback:function(){e.CloseReply(),e.getData()}}):e.$alert(t.data.msg,"提示",{confirmButtonText:"OK"})})},closeReplySingle:function(){this.selectReplySingleDialog=!1}},watch:{filterText:function(e){this.$refs.tree.filter(e)}},mounted:function(){this.userType=sessionStorage.getItem("userTypes"),this.userTypes=sessionStorage.getItem("userTypes"),2==this.userTypes||3==this.userTypes?(this.unitId=sessionStorage.getItem("unitId"),this.addAreaFlag=!1):this.getTreeData(),1!=this.userTypes&&this.getData()}},s={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"allcontent",attrs:{id:"drillTaskmanagement"}},[1==e.userType?a("el-col",{staticClass:"tree_box",attrs:{span:4}},[a("div",[a("el-input",{staticClass:"filter_text",attrs:{placeholder:"输入关键字进行过滤"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),e._v(" "),a("el-tree",{ref:"tree",attrs:{data:e.Treedata,props:e.treedefaultProps,"render-content":e.renderContent,"highlight-current":"","filter-node-method":e.filterNode},on:{"node-click":e.handleNodeClick}})],1)]):e._e(),e._v(" "),a("el-col",{staticStyle:{height:"100%","padding-left":"10px"},attrs:{span:20}},[a("div",{staticClass:"top"},[e._v("\n            演练名称:"),a("el-input",{attrs:{placeholder:"搜索名称"},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}}),e._v("  \n            "),e._v("\n            完成类型:"),a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.status,callback:function(t){e.status=t},expression:"status"}},e._l(e.statusData,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1),e._v("\n            选择时间:"),a("el-date-picker",{attrs:{align:"right",type:"date",placeholder:"开始日期"},model:{value:e.startTime,callback:function(t){e.startTime=t},expression:"startTime"}}),e._v("\n                - "),a("el-date-picker",{attrs:{align:"right",type:"date",placeholder:"结束日期"},model:{value:e.endTime,callback:function(t){e.endTime=t},expression:"endTime"}}),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.searchData}},[e._v("查询")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.searchreset}},[e._v("重置")]),e._v(" "),a("el-button",{attrs:{type:"primary",disabled:e.addAreaFlag},on:{click:e.openDialog}},[e._v("新增演练任务")])],1),e._v(" "),a("div",{staticClass:"bottom"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:""}},[a("el-table-column",{attrs:{prop:"name",label:"演练任务名称",width:"130"}}),e._v(" "),a("el-table-column",{attrs:{prop:"unitName",label:"演练单位",width:"150"}}),e._v(" "),a("el-table-column",{attrs:{prop:"managerUnitName",label:"发布单位",width:"150"}}),e._v(" "),a("el-table-column",{attrs:{prop:"chargeName",label:"负责人",width:"90"}}),e._v(" "),a("el-table-column",{attrs:{prop:"typeName",label:"演练类型",width:"85"}}),e._v(" "),a("el-table-column",{attrs:{prop:"endTime",label:"演练时间",width:"95"}}),e._v(" "),a("el-table-column",{attrs:{prop:"address",label:"演练地点",width:"300"}}),e._v(" "),a("el-table-column",{attrs:{prop:"statusCh",label:"完成状态",width:"80"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[1!=e.userType?a("span",[0==t.row.status?[t.row.managerUnitId!=e.unitId?[a("el-button",{attrs:{size:"mini",type:"primary",disabled:!0},on:{click:function(a){return e.SperRela(t.row.id)}}},[e._v("编辑")])]:[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return e.SperRela(t.row.id)}}},[e._v("编辑")])]]:[a("el-button",{attrs:{size:"mini",type:"primary",disabled:!0},on:{click:function(a){return e.SperRela(t.row.id)}}},[e._v("编辑")])],e._v(" "),t.row.managerUnitId!=e.unitId?[a("el-button",{attrs:{size:"mini",type:"danger",disabled:!0},on:{click:function(a){return e.deleteBox(t.row.id)}}},[e._v("删除")])]:[a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.deleteBox(t.row.id)}}},[e._v("删除")])],e._v(" "),3==e.userTypes?[0==t.row.status?[a("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(a){return e.openSubmitBox(t.row.id)}}},[e._v("完成")])]:[a("el-button",{attrs:{size:"mini",type:"success",disabled:!0},on:{click:function(a){return e.openSubmitBox(t.row.id)}}},[e._v("完成")])]]:e._e()],2):e._e(),e._v(" "),a("el-button",{attrs:{size:"mini",type:"warning"},on:{click:function(a){return e.searchBox(t.row.id)}}},[e._v("查看反馈")])]}}])})],1),e._v(" "),a("div",{staticClass:"page_all"},[a("pagination",{ref:"paginationChild",attrs:{total:e.total},on:{pageChange:e.pageChange}})],1),e._v(" "),a("div",{staticClass:"dialog_transfer"},[a("el-dialog",{attrs:{title:"演练信息",visible:e.visibleDialog,"close-on-click-modal":!1,"modal-append-to-body":!1,"before-close":e.Closetransfer},on:{"update:visible":function(t){e.visibleDialog=t}}},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{rules:e.rules,model:e.ruleForm,data:e.ruleForm,"status-icon":"","label-width":"150px"}},[a("el-form-item",{attrs:{label:"演练任务名称",prop:"name"}},[a("el-input",{model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),e._v(" "),3!=e.userTypes?[a("el-form-item",{attrs:{label:"演练单位",prop:"unitId"}},[a("el-select",{attrs:{filterable:"",placeholder:"请选择"},on:{change:e.changeUnit},model:{value:e.ruleForm.unitId,callback:function(t){e.$set(e.ruleForm,"unitId",t)},expression:"ruleForm.unitId"}},e._l(e.unitIdData,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1)]:e._e(),e._v(" "),a("el-form-item",{attrs:{label:"演练负责人",prop:"chargeId"}},[a("el-select",{attrs:{filterable:"",placeholder:"请选择"},model:{value:e.ruleForm.chargeId,callback:function(t){e.$set(e.ruleForm,"chargeId",t)},expression:"ruleForm.chargeId"}},e._l(e.userData,function(e){return a("el-option",{key:e.id,attrs:{label:e.username,value:e.id}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"演练预计参加人数",prop:"planPersonNum"}},[a("el-input",{model:{value:e.ruleForm.planPersonNum,callback:function(t){e.$set(e.ruleForm,"planPersonNum",t)},expression:"ruleForm.planPersonNum"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"演练类型",prop:"type"}},[a("el-radio",{attrs:{label:"2"},model:{value:e.ruleForm.type,callback:function(t){e.$set(e.ruleForm,"type",t)},expression:"ruleForm.type"}},[e._v("综合演练")])],1),e._v(" "),a("el-form-item",{attrs:{label:"演练日期",prop:"endTime"}},[a("el-date-picker",{attrs:{align:"right",type:"date",placeholder:"选择日期","picker-options":e.pickerOptions},model:{value:e.ruleForm.endTime,callback:function(t){e.$set(e.ruleForm,"endTime",t)},expression:"ruleForm.endTime"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"演练任务地点",prop:"address"}},[a("el-input",{model:{value:e.ruleForm.address,callback:function(t){e.$set(e.ruleForm,"address",t)},expression:"ruleForm.address"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"演练任务描述",prop:"content"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.ruleForm.content,callback:function(t){e.$set(e.ruleForm,"content",t)},expression:"ruleForm.content"}})],1),e._v(" "),a("el-form-item",{staticClass:"formfooter"},[a("el-button",{directives:[{name:"noMoreClick",rawName:"v-noMoreClick"}],attrs:{type:"primary"},on:{click:function(t){return e.handleSubmit("ruleForm")}}},[e._v("立即提交")]),e._v(" "),a("el-button",{on:{click:e.Closetransfer}},[e._v("关闭")])],1)],2)],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"演练反馈",visible:e.visibleReply,"close-on-click-modal":!1,"modal-append-to-body":!1,"before-close":e.CloseReply},on:{"update:visible":function(t){e.visibleReply=t}}},[a("el-form",{ref:"replyForm",staticClass:"demo-ruleForm",attrs:{rules:e.replyRules,model:e.replyForm,data:e.replyForm,"status-icon":"","label-width":"150px"}},[a("el-form-item",{attrs:{label:"实际参加人数",prop:"actualPersonNum"}},[a("el-input",{model:{value:e.replyForm.actualPersonNum,callback:function(t){e.$set(e.replyForm,"actualPersonNum",t)},expression:"replyForm.actualPersonNum"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"演练描述",prop:"content"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.replyForm.content,callback:function(t){e.$set(e.replyForm,"content",t)},expression:"replyForm.content"}})],1),e._v(" "),a("el-form-item",{staticClass:"replyPhoto",attrs:{label:"图片(最多三张)"}},[a("el-upload",{attrs:{action:"","list-type":"picture-card","on-preview":e.handlePictureCardPreview,"http-request":e.replyPhotoSubmit,limit:3,"on-remove":e.handleRemove}},[a("i",{staticClass:"el-icon-plus"})]),e._v(" "),a("el-dialog",{attrs:{visible:e.replyPhotoVisible},on:{"update:visible":function(t){e.replyPhotoVisible=t}}},[a("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],1),e._v(" "),a("el-form-item",{staticClass:"formfooter"},[a("el-button",{directives:[{name:"noMoreClick",rawName:"v-noMoreClick"}],attrs:{type:"primary"},on:{click:function(t){return e.SubmitReply("replyForm")}}},[e._v("立即提交")]),e._v(" "),a("el-button",{on:{click:e.CloseReply}},[e._v("关闭")])],1)],1)],1),e._v(" "),a("el-dialog",{staticClass:"Feedback dialog",attrs:{title:"反馈信息",visible:e.selectReplySingleDialog,"close-on-click-modal":!1,"before-close":e.closeReplySingle},on:{"update:visible":function(t){e.selectReplySingleDialog=t}}},[a("div",{staticClass:"divBox"},[a("div",{staticClass:"descript"},[e._v("实际参加人数:")]),e._v(" "),a("div",[e._v(e._s(e.ReplySingleData.actualPersonNum))])]),e._v(" "),a("div",{staticClass:"divBox"},[a("div",{staticClass:"descript"},[e._v("演练反馈提交人员:")]),e._v(" "),a("div",[e._v(e._s(e.ReplySingleData.feedbackName))])]),e._v(" "),a("div",{staticClass:"textarea"},[a("div",{staticClass:"descript"},[e._v("演练反馈描述:")]),e._v(" "),a("div",[e._v("\n                        "+e._s(e.ReplySingleData.content)+"\n                    ")])]),e._v(" "),a("div",{staticClass:"textarea"},[a("div",{staticClass:"descript"},[e._v("公告图片:")]),e._v(" "),a("div",{staticClass:"img"},e._l(e.ReplySingleData.imgUrlData,function(e){return a("span",{key:e.id,staticStyle:{display:"inline-block","margin-left":"10px"}},[a("img",{attrs:{src:e,alt:""}})])}),0)])])],1)])],1)},staticRenderFns:[]};var n=a("VU/8")(l,s,!1,function(e){a("aTAW")},"data-v-17293df9",null);t.default=n.exports},aTAW:function(e,t){}});