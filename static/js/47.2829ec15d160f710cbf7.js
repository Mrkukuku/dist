webpackJsonp([47],{O9wv:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("Dd8w"),r=a.n(i),l=a("woOf"),n=a.n(l),o=a("g5qz"),s=a("MCsY"),u={mixins:[o.a],components:{pagination:s.a},data:function(){this.$createElement;return{module:"PollingTask",search:"",FrozenVisible:!1,expireTimeOption:{disabledDate:function(e){return e.getTime()+864e5<Date.now()}},isClose:0,userType:"",unitId:"",data:[],defaultProps:{children:"children",label:"label"},routeData:[],addFalg:!1,dialogVisible:!1,detailFlag:!1,tableData:[],ruleForm:{name:"",uids:[],cycle:"",week:[],qrList:[],type:"",unitId:"",issuer:"",startTime:"",endTime:"",unames:[]},FrozenForm:{time:[],frozenDesc:"",id:"",isFrozen:1},rules:{name:[{required:!0,message:"请填写任务名称",trigger:"blur"}],startTime:[{required:!0,message:"请选择时间",trigger:"blur"}],endTime:[{required:!0,message:"请选择时间",trigger:"blur"}],uids:[{required:!0,message:"请选择人员",trigger:"blur"}],qrList:[{required:!0,message:"请选择路线",trigger:"change"}],cycle:[{required:!0,message:"请选择周期",trigger:"blur"}],week:[{required:!0,message:"请选择星期",trigger:"blur"}],type:[{required:!0,message:"请选择类型",trigger:"blur"}]},rulesFrozen:{time:[{required:!0,message:"请选择时间",trigger:"blur"}]},peopleOptions:[],cycleOptions:[{value:1,label:"年"},{value:2,label:"月"},{value:3,label:"周"},{value:4,label:"日"}],typeOptions:[{value:1,label:"巡检"},{value:2,label:"巡更"}],weekOptions:[{value:1,label:"星期一"},{value:2,label:"星期二"},{value:3,label:"星期三"},{value:4,label:"星期四"},{value:5,label:"星期五"},{value:6,label:"星期六"},{value:7,label:"星期天"}],renderFunc:function(e,t){return e("span",[t.name])},currentPage:1,rows:10,total:1}},methods:{closeFrozen:function(){this.FrozenVisible=!1,n()(this.$data.FrozenForm,this.$options.data().FrozenForm)},freeze:function(e){var t=this;if(0==e.isFrozen)this.FrozenVisible=!0,this.FrozenForm.id=e.id;else{var a=["冻结时间:\n\n\n"+(e.frozenStartTime&&this.$moment(e.frozenStartTime).format("YYYY-MM-DD HH:mm"))+"\n至\n"+(e.frozenEndTime&&this.$moment(e.frozenEndTime).format("YYYY-MM-DD HH:mm")),"冻结原因:\n"+e.frozenDesc,"你确定要解冻吗?"],i=[],r=this.$createElement;for(var l in a)i.push(r("p",null,a[l]));this.$confirm("提示",{title:"提示",message:r("div",null,i),showCancelButton:!0,confirmButtonText:"解冻",cancelButtonText:"取消"}).then(function(){t.axios({url:"/api/admin/xlm/fire/inspection/update",method:"post",data:{id:e.id,isFrozen:0}}).then(function(e){0==e.data.code?(t.getData(),t.$alert("成功","提示",{confirmButtonText:"OK"})):t.$alert(e.data.msg,"提示",{confirmButtonText:"OK"})})})}},handleFrozens:function(e){var t=this;this.$confirm("你确定要修改").then(function(){t.axios({url:"/api/admin/xlm/fire/inspection/close",method:"post",data:{id:t.unitId,type:e}}).then(function(e){0==e.data.code?(t.getData(),t.$alert(e.data.msg,"提示",{confirmButtonText:"OK"})):t.$alert(e.data.msg,"提示",{confirmButtonText:"OK"})})})},leftChange:function(e){var t=this.ruleForm.qrList.concat(e);this.$set(this.ruleForm,"qrList",t)},getData:function(){var e=this;this.unitId&&this.axios({url:"/api/admin/xlm/fire/inspection/list",method:"post",data:{unitId:this.unitId,pageNum:this.currentPage,pageSize:this.rows}}).then(function(t){0==t.data.code&&(e.tableData=t.data.data.data.list,e.total=t.data.data.data.total,e.isClose=t.data.data.isClose)})},editData:function(e){var t=this;this.axios({url:"/api/admin/xlm/fire/inspection/single",method:"post",data:{id:e}}).then(function(e){0==e.data.code&&(t.dialogVisible=!0,t.ruleForm=e.data.data)})},handleDelete:function(e){var t=this;this.$confirm("你确定要删除吗").then(function(){t.axios({url:"/api/admin/xlm/fire/inspection/delete",method:"post",data:{id:e}}).then(function(e){0==e.data.code?(t.getData(),t.$alert("删除成功","提示",{confirmButtonText:"OK"})):t.$alert(e.data.msg,"提示",{confirmButtonText:"OK"})})})},getOptions:function(){var e=this;this.axios({url:"/api/admin/user/list",method:"post",data:{pageNum:1,pageSize:9999,unitId:this.unitId}}).then(function(t){e.peopleOptions=t.data.list})},getQlist:function(e){var t=this;1==e&&this.axios({url:"/api/admin/device/qr/list",method:"post",data:{pageNum:1,pageSize:9999,unitId:this.unitId}}).then(function(e){t.routeData=e.data.list})},handleSubmit:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return t.$alert("添加数据失败,请填完必填字段!","提示",{confirmButtonText:"OK"}),!1;t.$confirm("你确定要提交吗").then(function(){var e="";e=t.ruleForm.id?"/api/admin/xlm/fire/inspection/update":"/api/admin/xlm/fire/inspection/add",t.axios({url:e,method:"post",data:r()({},t.ruleForm)}).then(function(e){0==e.data.code?(t.getData(),t.$alert("成功","提示",{confirmButtonText:"OK"}),t.closedialog()):t.$alert(e.data.msg,"提示",{confirmButtonText:"OK"})})})})},FrozenSubmit:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return t.$alert("添加数据失败,请填完必填字段!","提示",{confirmButtonText:"OK"}),!1;t.$confirm("你确定要提交吗").then(function(){t.axios({url:"/api/admin/xlm/fire/inspection/update",method:"post",data:r()({},t.FrozenForm)}).then(function(e){0==e.data.code?(t.getData(),t.$alert("成功","提示",{confirmButtonText:"OK"}),t.closeFrozen()):t.$alert(e.data.msg,"提示",{confirmButtonText:"OK"})})})})},closedialog:function(){this.dialogVisible=!1,this.dialogVisible1=!1,this.handleReset()},closedialog1:function(){this.detailFlag=!1,this.detailFlag1=!1},handleReset:function(){n()(this.$data.ruleForm,this.$options.data().ruleForm),this.ruleForm.unitId=this.unitId,this.ruleForm.issuer=sessionStorage.getItem("user_id"),this.$set(this.ruleForm,"id","")},renderContent:function(e,t){var a=t.node;return e("span",[e("i",{class:t.data.icon})," ",e("span",[a.label])])},handleNodeClick:function(e){this.unitId=e.id,this.ruleForm.unitId=e.id,this.rows=10,this.currentPage=1,0==e.type?this.addFalg=!1:this.addFalg=!0,this.getOptions(),this.getData()},pageChange:function(e){this.currentPage=e.page_index,this.rows=e.page_limit,this.getData()}},mounted:function(){this.userType=sessionStorage.getItem("userTypes"),this.ruleForm.issuer=sessionStorage.getItem("user_id"),this.ruleForm.unitId=Number(sessionStorage.getItem("unitId")),this.unitId=Number(sessionStorage.getItem("unitId")),3==this.userType&&(this.getOptions(),this.getData())}},c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"allcontent",attrs:{id:"er_polling_task"}},[a("el-row",{staticStyle:{height:"100%"}},[3!=e.userType?a("el-col",{staticClass:"tree_box",attrs:{span:4}},[a("div",[a("el-input",{staticClass:"filter_text",attrs:{placeholder:"输入关键字进行过滤"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),e._v(" "),a("el-tree",{ref:"tree",attrs:{data:e.Treedata,props:e.defaultProps,"render-content":e.renderContent,"highlight-current":"","filter-node-method":e.filterNode},on:{"node-click":e.handleNodeClick}})],1)]):e._e(),e._v(" "),a("el-col",{staticStyle:{height:"100%"},attrs:{span:20}},[a("div",{staticClass:"top"},[e.addFalg||3==e.userType?a("div",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.opendialog(1)}}},[a("i",{staticClass:"el-icon-plus"}),e._v(" 新增巡检任务")]),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:1==e.isClose,expression:"isClose==1"}],staticClass:"Frozen",attrs:{type:"primary"},on:{click:function(t){return e.handleFrozens(0)}}},[e._v("开启")]),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:0==e.isClose,expression:"isClose==0"}],staticClass:"Frozen",attrs:{type:"warning"},on:{click:function(t){return e.handleFrozens(1)}}},[e._v("关闭")])],1):e._e()]),e._v(" "),a("div",{staticStyle:{"margin-top":"10px",height:"88%",position:"relative"}},[a("el-table",{staticStyle:{width:"150"},attrs:{data:e.tableData,border:"",align:"center","header-align":"center"}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"任务名称",align:"center",width:"250"}}),e._v(" "),a("el-table-column",{attrs:{prop:"unames",label:"巡检人员",align:"center",width:"300"}}),e._v(" "),a("el-table-column",{attrs:{label:"巡检周期",align:"center",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\r\n                       "+e._s((1==t.row.cycle?"年":2==t.row.cycle&&"月")||3==t.row.cycle&&"周"||"日")+" \r\n                    ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"巡检时段",align:"center",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\r\n                       "+e._s(t.row.startTime)+" - "+e._s(t.row.endTime)+"\r\n                    ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"任务完成情况",align:"center",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\r\n                       "+e._s(0==t.row.status?"未完成":"已完成")+"\r\n                    ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticClass:"el-icon-edit",attrs:{size:"mini",type:"primary"},on:{click:function(a){return e.editData(t.row.id)}}},[e._v("编辑")]),e._v(" "),a("el-button",{staticClass:"el-icon-delete",attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.handleDelete(t.row.id)}}},[e._v("删除")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"warning"},on:{click:function(a){return e.freeze(t.row)}}},[e._v(" "+e._s(0==t.row.isFrozen?"冻结":"解冻")+" ")])]}}])})],1),e._v(" "),a("div",{staticClass:"page",staticStyle:{position:"absolute",bottom:"0"}},[a("pagination",{attrs:{total:e.total},on:{pageChange:e.pageChange}})],1)],1),e._v(" "),a("el-dialog",{staticClass:"dialog",attrs:{title:"添加修改巡检任务",visible:e.dialogVisible,width:"45%","close-on-click-modal":!1,"before-close":e.closedialog},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"巡检任务名称",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入巡检任务名称"},model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"巡检类型",prop:"type"}},[a("el-select",{attrs:{placeholder:"请选择"},on:{change:e.getQlist},model:{value:e.ruleForm.type,callback:function(t){e.$set(e.ruleForm,"type",t)},expression:"ruleForm.type"}},e._l(e.typeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"巡检周期",prop:"cycle"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.ruleForm.cycle,callback:function(t){e.$set(e.ruleForm,"cycle",t)},expression:"ruleForm.cycle"}},e._l(e.cycleOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),3==e.ruleForm.cycle?a("el-form-item",{attrs:{label:"巡检星期",prop:"week"}},[a("el-select",{attrs:{filterable:"",multiple:""},model:{value:e.ruleForm.week,callback:function(t){e.$set(e.ruleForm,"week",t)},expression:"ruleForm.week"}},e._l(e.weekOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"巡检开始时间",prop:"startTime"}},[a("el-time-picker",{attrs:{"value-format":"HH:mm",format:"HH:mm",placeholder:"巡检开始时间"},model:{value:e.ruleForm.startTime,callback:function(t){e.$set(e.ruleForm,"startTime",t)},expression:"ruleForm.startTime"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"巡检结束时间",prop:"endTime"}},[a("el-time-picker",{attrs:{"value-format":"HH:mm",format:"HH:mm",placeholder:"巡检结束时间"},model:{value:e.ruleForm.endTime,callback:function(t){e.$set(e.ruleForm,"endTime",t)},expression:"ruleForm.endTime"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"巡检人员",prop:"uids"}},[a("el-select",{attrs:{filterable:"",multiple:""},model:{value:e.ruleForm.uids,callback:function(t){e.$set(e.ruleForm,"uids",t)},expression:"ruleForm.uids"}},e._l(e.peopleOptions,function(e){return a("el-option",{key:e.id,attrs:{label:e.username,value:e.id}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"巡检路线",prop:"qrList"}},[a("el-transfer",{staticClass:"transfer",staticStyle:{"text-align":"left",display:"inline-block"},attrs:{filterable:"","render-content":e.renderFunc,props:{key:"id",label:"name"},titles:["巡检二维码","巡检路线"],format:{noChecked:"${total}",hasChecked:"${checked}/${total}"},"target-order":"push",data:e.routeData},on:{"left-check-change":e.leftChange},model:{value:e.ruleForm.qrList,callback:function(t){e.$set(e.ruleForm,"qrList",t)},expression:"ruleForm.qrList"}})],1),e._v(" "),a("el-form-item",{staticClass:"formfooter"},[a("el-button",{directives:[{name:"noMoreClick",rawName:"v-noMoreClick"}],attrs:{type:"primary"},on:{click:function(t){return e.handleSubmit("ruleForm")}}},[e._v("立即提交")]),e._v(" "),a("el-button",{on:{click:e.closedialog}},[e._v("取 消")])],1)],1)],1),e._v(" "),a("el-dialog",{staticClass:"dialog",attrs:{title:"查看巡检任务",visible:e.detailFlag,width:"33%","close-on-click-modal":!1,"before-close":e.closedialog1},on:{"update:visible":function(t){e.detailFlag=t}}}),e._v(" "),a("el-dialog",{attrs:{title:"冻结任务",visible:e.FrozenVisible,width:"30%","close-on-click-modal":!1,"before-close":e.closeFrozen},on:{"update:visible":function(t){e.FrozenVisible=t}}},[a("el-form",{ref:"FrozenForm",staticClass:"demo-ruleForm FrozenForm",attrs:{rules:e.rulesFrozen,model:e.FrozenForm,data:e.FrozenForm,"status-icon":"","label-width":"130px"}},[a("el-form-item",{attrs:{label:"冻结时间",prop:"time"}},[a("el-date-picker",{attrs:{type:"datetimerange","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":e.expireTimeOption},model:{value:e.FrozenForm.time,callback:function(t){e.$set(e.FrozenForm,"time",t)},expression:"FrozenForm.time"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"冻结原因原因"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.FrozenForm.frozenDesc,callback:function(t){e.$set(e.FrozenForm,"frozenDesc",t)},expression:"FrozenForm.frozenDesc"}})],1),e._v(" "),a("el-form-item",{staticClass:"formfooter"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.FrozenSubmit("FrozenForm")}}},[e._v("冻结")]),e._v(" "),a("el-button",{on:{click:e.closeFrozen}},[e._v("取 消")])],1)],1)],1)],1)],1)],1)},staticRenderFns:[]};var d=a("VU/8")(u,c,!1,function(e){a("nFrO")},null,null);t.default=d.exports},nFrO:function(e,t){}});