webpackJsonp([29],{"1iqi":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("woOf"),n=i.n(a),r={data:function(){return{data:[],newApiGroupName:"",filterText:"",tableData:[],defaultProps:{children:"children",name:"content"},dialogVisibleThree:!1,time:[],ruleForm:{content:"",method:"",note:""},rules:{content:[{required:!0,message:"请输入维保内容",trigger:"blur"}],method:[{required:!0,message:"请输入测试方法和要求",trigger:"blur"}],note:[{required:!0,message:"请输入相关补充备注",trigger:"blur"}]},unitId:"",pid:0}},methods:{getApiGroupData:function(){var e=this;this.axios({url:"/api/admin/maintenancelib/list",method:"post"}).then(function(t){0==t.data.code?e.data=t.data.data:e.$alert(t.data.msg,"提示",{confirmButtonText:"OK"})})},addChild:function(e,t){var i=this,a={isEdit:1,content:"xxxxxxx",children:[],pid:t.id};t.children||this.$set(t,"children",[]),t.children.push(a),this.$nextTick(function(){i.$refs.input.focus()})},addParent:function(){var e=this;this.data.push({isEdit:1,content:"xxxxxxx",children:[],pid:0}),this.$nextTick(function(){e.$refs.input.focus()})},remove:function(e,t){var i=e.parent,a=i.data.children||i.data,n=a.findIndex(function(e){return e.id===t.id});t.id?this.deleteParentChild(t.id):a.splice(n,1)},deleteParentChild:function(e){var t=this;this.$confirm("你确定要删除吗").then(function(){t.axios({url:"/api/admin/maintenancelib/delete",method:"post",data:{id:e}}).then(function(e){0==e.data.code?t.$message({type:"success",message:"删除成功"}):t.$message({type:"error",message:e.data.msg}),t.getApiGroupData()})})},edit:function(e,t){for(var i in this.data)if(delete this.data[i].isEdit,this.data[i].children)for(var a in this.data[i].children)delete this.data[i].children[a].isEdit;this.$set(t,"isEdit",1),this.newApiGroupName=t.content},cancelEdit:function(e,t){this.newApiGroupName="",this.$set(t,"isEdit",0)},submitEdit:function(e,t){t.name==this.newApiGroupName?(this.newApiGroupName="",this.$set(t,"isEdit",0)):this.newApiGroupName?(this.$set(t,"content",this.newApiGroupName),this.newApiGroupName="",this.$set(t,"isEdit",0),this.updatesubmit(t.pid,t.content,t.id)):this.getApiGroupData()},updatesubmit:function(e,t,i){var a,n=this;a=i?"/api/admin/maintenancelib/update":"/api/admin/maintenancelib/add",this.axios({url:a,method:"post",data:{pid:e,content:t,id:i}}).then(function(e){0==e.data.code?n.$message({type:"success",message:"保存成功"}):n.$message({type:"error",message:e.data.msg}),n.getApiGroupData()})},nodeclick:function(e,t,i){console.log(e),0!=e.pid&&this.getData(e.id)},filterNode:function(e,t){return!e||-1!==t.content.indexOf(e)},addThreeData:function(){this.dialogVisibleThree=!0},ThreeClose:function(){this.dialogVisibleThree=!1,delete this.ruleForm.id,n()(this.$data.ruleForm,this.$options.data().ruleForm)},editThree:function(e){var t=this;this.axios({url:"/api/admin/maintenancelib/content/single",method:"post",data:{id:e}}).then(function(e){if(0==e.data.code){t.ruleForm=e.data.data;var i=[];1==t.ruleForm.month&&i.push("1"),1==t.ruleForm.quarter&&i.push("2"),1==t.ruleForm.year&&i.push("3"),t.time=i,t.addThreeData()}else t.$message({type:"error",message:e.data.msg})})},handleCheckedCitiesChange:function(e){},deleteThree:function(e){var t=this;this.$confirm("你确定要删除吗").then(function(){t.axios({url:"/api/admin/maintenancelib/content/delete",method:"post",data:{id:e}}).then(function(e){0==e.data.code?t.$message({type:"success",message:"删除成功"}):t.$message({type:"error",message:e.data.msg}),t.getData(t.libId)})})},submitThree:function(e){var t=this;this.$refs[e].validate(function(e){if(e){var i="/api/admin/maintenancelib/content/add";for(var a in t.ruleForm.id&&(i="/api/admin/maintenancelib/content/update"),t.ruleForm.libId=t.libId,t.ruleForm.month=0,t.ruleForm.quarter=0,t.ruleForm.year=0,t.time)"1"==t.time[a]&&(t.ruleForm.month=1),"2"==t.time[a]&&(t.ruleForm.quarter=1),"3"==t.time[a]&&(t.ruleForm.year=1);t.axios({url:i,method:"post",data:t.ruleForm}).then(function(e){0==e.data.code?(t.$message({type:"success",message:"保存成功"}),t.ThreeClose()):t.$message({type:"error",message:e.data.msg}),t.getData(t.libId)})}})},getData:function(e){var t=this;this.libId=e,this.axios({url:"/api/admin/maintenancelib/content/list",method:"post",data:{id:e}}).then(function(e){0==e.data.code?t.tableData=e.data.data:t.$message({type:"error",message:e.data.msg})})}},mounted:function(){this.unitId=sessionStorage.getItem("unitId"),this.getApiGroupData()},watch:{filterText:function(e){this.$refs.tree.filter(e)}}},o={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"allcontent maintenanceLibrary"},[i("el-col",{staticClass:"tree_box",attrs:{span:6}},[i("div",{staticClass:"treeTop"},[i("el-input",{attrs:{placeholder:"输入关键字进行过滤"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),e._v(" "),i("el-button",{attrs:{type:"success"},on:{click:e.addParent}},[e._v("新增")])],1),e._v(" "),i("el-tree",{ref:"tree",attrs:{data:e.data,"node-key":"id","default-expand-all":"","expand-on-click-node":!1,"filter-node-method":e.filterNode},on:{"node-click":e.nodeclick},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.node,n=t.data;return i("span",{staticClass:"custom-tree-node"},[1==n.isEdit?[i("el-input",{ref:"input",staticStyle:{height:"20px line-height:20px"},model:{value:e.newApiGroupName,callback:function(t){e.newApiGroupName=t},expression:"newApiGroupName"}}),e._v(" "),i("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(){return e.cancelEdit(a,n)}}},[e._v("撤销")]),e._v(" "),i("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(){return e.submitEdit(a,n)}}},[e._v("保存")])]:i("span",[i("span",{domProps:{textContent:e._s(n.content)}}),e._v(" "),i("span",[i("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(){return e.edit(a,n)}}},[e._v("\n                编辑\n              ")]),e._v(" "),0==n.pid?[i("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(){return e.addChild(a,n)}}},[e._v("\n                  新增\n                ")])]:e._e(),e._v(" "),i("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(){return e.remove(a,n)}}},[e._v("\n                删除\n              ")])],2)])],2)}}])})],1),e._v(" "),i("el-col",{attrs:{span:18}},[i("div",{staticClass:"top"},[i("el-button",{attrs:{type:"success"},on:{click:e.addThreeData}},[e._v("新增")])],1),e._v(" "),i("el-table",{attrs:{data:e.tableData,border:""}},[i("el-table-column",{attrs:{prop:"content",label:"维保内容",width:"240"}}),e._v(" "),i("el-table-column",{attrs:{prop:"method",label:"测试方法和要求",width:"350"}}),e._v(" "),i("el-table-column",{attrs:{prop:"note",label:"备注",width:"230"}}),e._v(" "),i("el-table-column",{attrs:{label:"维保周期",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.month?i("span",[e._v("\n            月,\n          ")]):e._e(),e._v(" "),1==t.row.quarter?i("span",[e._v("\n            季,\n          ")]):e._e(),e._v(" "),1==t.row.year?i("span",[e._v("\n            年\n          ")]):e._e()]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(i){return e.editThree(t.row.id)}}},[e._v("编辑")]),e._v(" "),i("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(i){return e.deleteThree(t.row.id)}}},[e._v("删除")])]}}])})],1),e._v(" "),i("el-dialog",{attrs:{title:"维保项",visible:e.dialogVisibleThree,"close-on-click-modal":!1,"before-close":e.ThreeClose},on:{"update:visible":function(t){e.dialogVisibleThree=t}}},[i("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"120px"}},[i("el-form-item",{attrs:{label:"维保内容",prop:"content"}},[i("el-input",{attrs:{type:"textarea"},model:{value:e.ruleForm.content,callback:function(t){e.$set(e.ruleForm,"content",t)},expression:"ruleForm.content"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"测试方法和要求",prop:"method"}},[i("el-input",{attrs:{type:"textarea"},model:{value:e.ruleForm.method,callback:function(t){e.$set(e.ruleForm,"method",t)},expression:"ruleForm.method"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"备注",prop:"note"}},[i("el-input",{attrs:{type:"textarea"},model:{value:e.ruleForm.note,callback:function(t){e.$set(e.ruleForm,"note",t)},expression:"ruleForm.note"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"维保周期",prop:"time"}},[i("el-checkbox-group",{model:{value:e.time,callback:function(t){e.time=t},expression:"time"}},[i("el-checkbox",{attrs:{label:"1"}},[e._v("月")]),e._v(" "),i("el-checkbox",{attrs:{label:"2"}},[e._v("季")]),e._v(" "),i("el-checkbox",{attrs:{label:"3"}},[e._v("年")])],1)],1),e._v(" "),i("el-form-item",{staticClass:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitThree("ruleForm")}}},[e._v("确 定")]),e._v(" "),i("el-button",{on:{click:e.ThreeClose}},[e._v("取 消")])],1)],1)],1)],1)],1)},staticRenderFns:[]};var s=i("VU/8")(r,o,!1,function(e){i("r1AW")},"data-v-50e95a3d",null);t.default=s.exports},r1AW:function(e,t){}});