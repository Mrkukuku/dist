webpackJsonp([31],{NMe2:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=a("Dd8w"),i=a.n(l),r={components:{pagination:a("MCsY").a},data:function(){return{module:"installationInformation",unitId:sessionStorage.getItem("unitId"),userType:sessionStorage.getItem("userTypes"),title:"",unitName:"",treedefaultProps:{children:"children",label:"label"},currentPage:1,rows:10,total:1,ruleForm:{title:"",installerName:"",installerPhone:"",debuggerName:"",debuggerPhone:"",unitName:"",unitId:""},rules:{title:[{required:!0,message:"请输入安装标题",trigger:"blur"}],installerName:[{required:!0,message:"请输入安装人姓名",trigger:"blur"}],installerPhone:[{required:!0,message:"请输入安装人电话",trigger:"blur"}],debuggerName:[{required:!0,message:"请输入调试人员",trigger:"blur"}],debuggerPhone:[{required:!0,message:"请输入调试人员电话",trigger:"blur"}],unitName:[{required:!0,message:"请输入安装公司",trigger:"blur"}]},tableData:[],dialogVisible:!1,treeData:[],filterText:"",smsPhoneTypeData:[{name:"竣工检测",id:1},{name:"年度检测",id:1},{name:"专项检测",id:1},{name:"维护保养",id:1},{name:"安全评估",id:1}]}},methods:{searchsubmit:function(){var e=this;this.currentPage=1,this.$refs.paginationChild.changePageNum(this.currentPage),this.axios({url:"/api/admin/device/install.search",method:"post",data:{unitId:this.unitId,pageSize:this.rows,pageNum:this.currentPage,title:this.title,unitName:this.unitName}}).then(function(t){0==t.data.code?(e.tableData=t.data.list,e.total=t.data.total,e.currentPage=t.data.pageNum):e.$alert(t.data.msg,"提示",{confirmButtonText:"OK"})})},searchreset:function(){this.title="",this.unitName=""},editdatas:function(e){var t=this;this.axios({url:"/api/admin/device/install.search",method:"post",data:{id:e,pageNum:1,pageSize:100}}).then(function(e){t.ruleForm=e.data.list[0],t.opendialog()})},handleNodeClick:function(e){this.unitId=e.id,this.rows=10,this.currentPage=1,this.getData()},opendialog:function(){this.dialogVisible=!0},closedialog:function(){this.dialogVisible=!1},renderContent:function(e,t){var a=t.node;return e("span",[e("i",{class:t.data.icon})," ",e("span",[a.label])])},pageChange:function(e){this.currentPage=e.page_index,this.rows=e.page_limit,this.getData()},getData:function(){var e=this;this.axios({url:"/api/admin/fire/inspection/config/single",method:"post",data:{id:this.unitId}}).then(function(t){0==t.data.code&&(e.tableData=t.data.data)})},Treeunit:function(){var e=this;this.axios({url:"/api/admin/unit/list.left",method:"post",params:{pageNum:1,pageSize:1e3}}).then(function(t){if(0==t.data.code){if(t.data.data){e.treeData=t.data.data,e.data=t.data.data;for(var a=0;a<e.treeData.length;a++)e.treeData[a].icon="el-icon-folder"}}else e.$alert(t.data.msg,"提示",{confirmButtonText:"OK"})})},filterNode:function(e,t){return!e||-1!==t.label.indexOf(e)},handleSubmit:function(e){var t=this,a=this;this.$refs[e].validate(function(e){if(e){var l="";l=a.ruleForm.id?"/api/admin/fire/inspection/config/update":"/api/admin/fire/inspection/config/add",a.axios({url:l,method:"post",data:i()({},t.ruleForm)}).then(function(e){e.data.code})}else t.$message.error("请填写必填字段")})},handleChange:function(e,t){t.length>1&&t.splice(0,1)},upload:function(){console.log(111111)}},mounted:function(){3!=this.userType?this.Treeunit():this.getData()},watch:{filterText:function(e){this.$refs.tree.filter(e)}}},n={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"contract allcontent"},[3!=e.userType?a("el-col",{staticClass:"tree_box",attrs:{span:4}},[a("div",[a("el-input",{staticClass:"filter_text",attrs:{placeholder:"输入关键字进行过滤"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),e._v(" "),a("el-tree",{ref:"tree",attrs:{data:e.treeData,props:e.treedefaultProps,"render-content":e.renderContent,"highlight-current":"","filter-node-method":e.filterNode},on:{"node-click":e.handleNodeClick}})],1)]):e._e(),e._v(" "),a("el-col",{staticStyle:{height:"100%"},attrs:{span:20}},[a("div",{staticClass:"top"},[a("div",[e._v("\n                标题:\n                "),a("el-input",{model:{value:e.title,callback:function(t){e.title=t},expression:"title"}}),e._v("  \n                "),a("el-button",{attrs:{type:"primary"},on:{click:e.searchsubmit}},[e._v("查询")]),e._v(" "),a("el-button",{on:{click:e.searchreset}},[e._v("重置")]),e._v(" "),2==e.userType?[a("el-button",{attrs:{type:"success"},on:{click:e.opendialog}},[e._v("新增")])]:e._e()],2)]),e._v(" "),a("div",{staticStyle:{"margin-top":"10px",height:"88%",position:"relative"}},[a("el-table",{staticStyle:{width:"150"},attrs:{data:e.tableData,border:""}},[a("el-table-column",{attrs:{prop:"title",label:"合同名称",width:"200"}}),e._v(" "),3==e.userType?[a("el-table-column",{attrs:{prop:"installerPhone",label:"维保企业",width:"200"}})]:e._e(),e._v(" "),a("el-table-column",{attrs:{prop:"unitName",label:"签订日期",width:"190"}}),e._v(" "),a("el-table-column",{attrs:{prop:"debuggerName",label:"结束日期",width:"190"}}),e._v(" "),a("el-table-column",{attrs:{prop:"debuggerPhone",label:"项目负责人",width:"200"}}),e._v(" "),a("el-table-column",{attrs:{prop:"debuggerPhone",label:"状态",width:"200"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return e.editdatas(t.row.id)}}},[e._v("更新")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return e.editdatas(t.row.id)}}},[e._v("续签")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.handleDelete(t.row.id)}}},[e._v("终止")])]}}])})],2),e._v(" "),a("div",{staticStyle:{position:"absolute",bottom:"0"}},[a("pagination",{ref:"paginationChild",attrs:{total:e.total},on:{pageChange:e.pageChange}})],1)],1),e._v(" "),a("el-dialog",{staticClass:"dialog",attrs:{title:"添加/修改合同",visible:e.dialogVisible,"close-on-click-modal":!1,"before-close":e.closedialog},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"200px"}},[a("el-form-item",{attrs:{label:"合同名称",prop:"title"}},[a("el-input",{model:{value:e.ruleForm.title,callback:function(t){e.$set(e.ruleForm,"title",t)},expression:"ruleForm.title"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"合同类型",prop:"debuggerName"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.ruleForm.debuggerName,callback:function(t){e.$set(e.ruleForm,"debuggerName",t)},expression:"ruleForm.debuggerName"}},e._l(e.smsPhoneTypeData,function(e){return a("el-option",{key:e.value,attrs:{label:e.name,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"委托单位",prop:"debuggerName"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.ruleForm.debuggerName,callback:function(t){e.$set(e.ruleForm,"debuggerName",t)},expression:"ruleForm.debuggerName"}},e._l(e.smsPhoneTypeData,function(e){return a("el-option",{key:e.value,attrs:{label:e.name,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"签订日期(保存后不能修改)",prop:"installerPhone"}},[a("el-date-picker",{attrs:{type:"date",placeholder:"选择日期"},model:{value:e.ruleForm.installerName,callback:function(t){e.$set(e.ruleForm,"installerName",t)},expression:"ruleForm.installerName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"结束日期(保存后不能修改)",prop:"unitName"}},[a("el-date-picker",{attrs:{type:"date",placeholder:"选择日期"},model:{value:e.ruleForm.installerName,callback:function(t){e.$set(e.ruleForm,"installerName",t)},expression:"ruleForm.installerName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"合同总价人名币(元)",prop:"title"}},[a("el-input",{model:{value:e.ruleForm.title,callback:function(t){e.$set(e.ruleForm,"title",t)},expression:"ruleForm.title"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"维保服务电话",prop:"title"}},[a("el-input",{model:{value:e.ruleForm.title,callback:function(t){e.$set(e.ruleForm,"title",t)},expression:"ruleForm.title"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"上传合同附件",prop:"title"}},[a("el-upload",{staticClass:"upload-demo",attrs:{action:"","http-request":e.upload,"on-change":e.handleChange}},[a("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")]),e._v("\n                              "),a("span",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传jpg/png文件，且不超过500kb")])],1)],1),e._v(" "),a("el-form-item",{staticClass:"formfooter"},[a("el-button",{directives:[{name:"noMoreClick",rawName:"v-noMoreClick"}],attrs:{type:"primary"},on:{click:function(t){return e.handleSubmit("ruleForm")}}},[e._v("立即提交")]),e._v(" "),a("el-button",{on:{click:e.closedialog}},[e._v("取 消")])],1)],1)],1)],1)],1)},staticRenderFns:[]};var o=a("VU/8")(r,n,!1,function(e){a("onla")},"data-v-4c7920ee",null);t.default=o.exports},onla:function(e,t){}});