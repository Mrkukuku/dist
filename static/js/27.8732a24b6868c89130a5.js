webpackJsonp([27],{kTYJ:function(e,t){},rzz7:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("u2KI"),n=a.n(i),l=a("woOf"),r=a.n(l),o=a("nQ03"),s=(a("/IwO"),a("MCsY")),d={mixins:[o.a],components:{pagination:s.a},data:function(){return{userType:"",areaName:"",type:"",tableData:[],pageNum:1,pageSize:10,total:200,data:[],filterText:"",Treedata:[],unitId:"",addAreaFlag:!0,transfer:!1,treedefaultProps:{children:"children",label:"label"},filterMethod:function(e,t){return t.initial.indexOf(e)>-1},pickerOptions:{disabledDate:function(e){var t=new Date;return t.setTime(t.getTime()-864e5),e.getTime()<=t}},ruleForm:{name:"",expireTime:"",installAddres:"",deviceOptionLibId:""},rules:{name:[{required:!0,message:"请输入区域名称",trigger:"blur"}],installAddres:[{required:!0,message:"请输入设备安装位置",trigger:"blur"}],deviceOptionLibId:[{required:!0,message:"请选择设备类型",trigger:"blur"}]},singleData:[],typeOptionsData:[{name:"未过期",value:"0"},{name:"已过期",value:"1"}],typeOptionsData1:[{name:"灭火器",value:"0"},{name:"消火栓",value:"1"},{name:"水泵房",value:"2"},{name:"巡更",value:"3"}],downImg:"",mapVisible:!1,allSelectList:[],qrList:[]}},methods:{getTypeList:function(){var e=this;this.$post("/api/admin/device/option/lib/list",{}).then(function(t){e.typeOptionsData1=t.data})},filterNode:function(e,t){return!e||-1!==t.label.indexOf(e)},renderContent:function(e,t){var a=t.node;return e("span",[e("i",{class:t.data.icon})," ",e("span",[a.label])])},handleNodeClick:function(e){this.unitId=e.id,0==e.type?this.addAreaFlag=!0:(this.addAreaFlag=!1,this.getData())},searchreset:function(){this.areaName="",this.type="",this.getData()},searchData:function(){this.pageNum=1,this.getData()},getTreeData:function(){var e=this;this.axios({url:"/api/admin/unit/list.left",method:"post",data:{pageNum:1e3,pageSize:1}}).then(function(t){0==t.data.code?e.Treedata=t.data.data:e.$alert(t.data.msg,"提示",{confirmButtonText:"OK"})})},openAddBox:function(){this.transfer=!0},closeAddBox:function(){this.transfer=!1,delete this.ruleForm.id,r()(this.$data.ruleForm,this.$options.data().ruleForm)},handleSubmit:function(e){var t=this,a=this;this.$refs[e].validate(function(e){e&&(t.ruleForm.unitId=t.unitId,t.ruleForm.site=t.ruleForm.address,t.axios({url:"/api/admin//device/qr/add",method:"post",data:t.ruleForm}).then(function(e){0==e.data.code?a.$alert("保存成功","提示",{confirmButtonText:"OK",callback:function(){a.closeAddBox(),a.getData()}}):a.$alert(e.data.msg,"提示",{confirmButtonText:"OK"})}))})},getData:function(){var e=this;this.axios({url:"/api/admin/device/qr/list",method:"post",data:{pageNum:this.pageNum,pageSize:this.pageSize,unitId:this.unitId,name:this.areaName,isExpire:this.type}}).then(function(t){if(0==t.data.code){for(var a in e.tableData=n()(t.data.list),e.tableData)null==e.tableData[a].expireTime?e.tableData[a].expireTime="永久":e.tableData[a].expireTime=e.$moment(e.tableData[a].expireTime).format("YYYY-MM-DD"),null==e.tableData[a].site&&(e.tableData[a].site="暂无");e.total=t.data.total}else e.$alert(t.data.msg,"提示",{confirmButtonText:"OK"})})},deleteBox:function(e){var t=this,a=this;this.$confirm("你确定要删除吗").then(function(){t.axios({url:"/api/admin//device/qr/delete",method:"post",data:{id:e}}).then(function(e){0==e.data.code?a.$alert("删除成功","提示",{confirmButtonText:"OK",callback:function(){a.getData()}}):a.$alert(e.data.msg,"提示",{confirmButtonText:"OK"})})})},print:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=void 0!==window.screenLeft?window.screenLeft:screen.left,n=void 0!==window.screenTop?window.screenTop:screen.top,l=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,r=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,o=l/2-(t=0==+t?l:t)/2+i,s=r/2-(a=0==+a?r:a)/2+n,d=window.open("","打印","toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=yes, copyhistory=no, width="+t+", height="+a+", top="+s+", left="+o);return d.document.write(e+"<style type='text/css'>@page{ margin: 10mm;}; html,body{margin:0;padding:0}; table.gridtable {font-family: verdana,arial,sans-serif;font-size:14px;color:#333333;border-width: 1px;border-color: #666666;border-collapse: collapse;}table.gridtable th {border-width: 1px;padding: 8px;border-style: solid;border-color: #666666;background-color: #dedede;}table.gridtable td {border-width: 1px;padding: 8px;border-style: solid;border-color: #666666;background-color: #ffffff;}</style>"),d.focus(),d.document.close(),d.print(),d},printingBox:function(e){var t=this;this.qrList=[e],this.$nextTick(function(){setTimeout(function(){t.print(document.getElementById("erwei").innerHTML,800,600)},800)})},pageChange:function(e){this.pageNum=e.page_index,this.pageSize=e.page_limit,this.getData()},allSelectionChange:function(e){},handleSelectionChange:function(e){var t=[];e.map(function(e,a){t.push(e.id)}),this.allSelectList=t},allPrint:function(){var e=this,t=this;this.allSelectList.length&&this.allSelectList.length<=100?this.axios({url:"/api/admin/device/qr/batch/print",method:"post",data:{idList:t.allSelectList}}).then(function(a){0==a.data.code?(e.qrList=n()(a.data.data),e.$nextTick(function(){setTimeout(function(){t.print(document.getElementById("erwei").innerHTML,800,600)},800)})):e.$alert(a.data.msg,"提示",{confirmButtonText:"OK"})}):this.allSelectList.length>100?this.$alert("最多打印100张","提示",{confirmButtonText:"OK"}):this.$alert("请选择二维码","提示",{confirmButtonText:"OK"})}},watch:{filterText:function(e){this.$refs.tree.filter(e)}},mounted:function(){this.userType=sessionStorage.getItem("userTypes"),3==this.userType?(this.unitId=sessionStorage.getItem("unitId"),this.addAreaFlag=!1,this.getData()):this.getTreeData(),this.getTypeList()}},c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"QRCode allcontent"},[1==e.userType||2==e.userType?a("el-col",{staticClass:"tree_box",attrs:{span:4}},[a("div",[a("el-input",{staticClass:"filter_text",attrs:{placeholder:"输入关键字进行过滤"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),e._v(" "),a("el-tree",{ref:"tree",attrs:{data:e.Treedata,props:e.treedefaultProps,"render-content":e.renderContent,"highlight-current":"","filter-node-method":e.filterNode},on:{"node-click":e.handleNodeClick}})],1)]):e._e(),e._v(" "),a("el-col",{staticStyle:{height:"100%","padding-left":"10px"},attrs:{span:3==e.userType?24:20}},[a("div",{staticClass:"top"},[e._v("\n            二维码名称:"),a("el-input",{attrs:{placeholder:"搜索名称"},model:{value:e.areaName,callback:function(t){e.areaName=t},expression:"areaName"}}),e._v("  \n            类型:"),a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.type,callback:function(t){e.type=t},expression:"type"}},e._l(e.typeOptionsData,function(e){return a("el-option",{key:e.value,attrs:{label:e.name,value:e.value}})}),1),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.searchData}},[e._v("查询")]),e._v(" "),a("el-button",{on:{click:e.searchreset}},[e._v("重置")]),e._v(" "),a("el-button",{attrs:{type:"primary",disabled:e.addAreaFlag},on:{click:e.openAddBox}},[e._v("新增二维码")]),e._v(" "),a("el-button",{attrs:{type:"primary",disabled:e.addAreaFlag},on:{click:e.allPrint}},[e._v("批量打印二维码")])],1),e._v(" "),a("div",{staticClass:"bottom"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:""},on:{"select-all":e.allSelectionChange,"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"45"}}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"二维码名称",width:"240"}}),e._v(" "),a("el-table-column",{attrs:{prop:"deviceTypeName",label:"类型",width:"130"}}),e._v(" "),a("el-table-column",{attrs:{prop:"expireTime",label:"二维码有效期",width:"300"}}),e._v(" "),a("el-table-column",{attrs:{prop:"installAddres",label:"安装地址",width:"250"}}),e._v(" "),a("el-table-column",{attrs:{prop:"site",label:"地址",width:"300"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.deleteBox(t.row.id)}}},[e._v("删除")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(a){return e.printingBox(t.row)}}},[e._v("打印\n                        ")])]}}])},[e._v(" "),a("div",{staticStyle:{display:"none"},attrs:{id:"erwei"}},e._l(e.qrList,function(t,i){return a("div",{key:i,staticStyle:{display:"flex","flex-direction":"column","align-items":"center",height:"138.5mm"}},[a("img",{attrs:{src:t.img,alt:"二维码"}}),e._v(" "),a("div",[a("div",{staticStyle:{"font-size":"20px"}},[e._v("设备名称："+e._s(t.name))]),e._v(" "),a("div",{staticStyle:{"font-size":"20px"}},[e._v("设备地址："+e._s(t.installAddres&&t.installAddres||""))])])])}),0)])],1),e._v(" "),a("div",{staticClass:"page_all"},[a("pagination",{attrs:{total:e.total},on:{pageChange:e.pageChange}})],1),e._v(" "),a("div",{staticClass:"dialog_transfer"},[a("el-dialog",{attrs:{title:"二维码信息",visible:e.transfer,"close-on-click-modal":!1,"modal-append-to-body":!1,"before-close":e.closeAddBox},on:{"update:visible":function(t){e.transfer=t}}},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{rules:e.rules,model:e.ruleForm,data:e.ruleForm,"status-icon":"","label-width":"150px"}},[a("el-form-item",{attrs:{label:"二维码名称",prop:"name"}},[a("el-input",{model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"设备安装位置",prop:"installAddres"}},[a("el-input",{model:{value:e.ruleForm.installAddres,callback:function(t){e.$set(e.ruleForm,"installAddres",t)},expression:"ruleForm.installAddres"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"设备类型",prop:"deviceOptionLibId"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.ruleForm.deviceOptionLibId,callback:function(t){e.$set(e.ruleForm,"deviceOptionLibId",t)},expression:"ruleForm.deviceOptionLibId"}},e._l(e.typeOptionsData1,function(e){return a("el-option",{key:e.value,attrs:{label:e.name,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"二维码有效截至时间"}},[a("el-date-picker",{attrs:{type:"date","picker-options":e.pickerOptions,placeholder:"选择日期"},model:{value:e.ruleForm.expireTime,callback:function(t){e.$set(e.ruleForm,"expireTime",t)},expression:"ruleForm.expireTime"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"地址","label-width":"150px"}},[a("el-input",{attrs:{disabled:!0,"label-width":"150px"},model:{value:e.ruleForm.address,callback:function(t){e.$set(e.ruleForm,"address",t)},expression:"ruleForm.address"}}),e._v(" "),a("el-button",{on:{click:e.openmap}},[e._v("点击地图")]),e._v(" "),a("div",{attrs:{id:"mapdiv"}},[a("el-dialog",{staticClass:"mapdialog",attrs:{title:"百度地图定位查询",visible:e.mapVisible,width:"95%","modal-append-to-body":!1,"before-close":e.handleClose},on:{"update:visible":function(t){e.mapVisible=t}}},[a("div",{staticClass:"amap-wrapper"},[a("el-amap-search-box",{staticClass:"search-box",attrs:{"search-option":e.searchOption,"on-search-result":e.onSearchResult}}),e._v(" "),a("el-button",{staticClass:"searchok",attrs:{type:"primary"},on:{click:e.getok}},[e._v("确定")]),e._v(" "),a("el-amap",{staticClass:"amap-demo bm_view",attrs:{vid:"amap-vue",plugin:e.plugins,events:e.events,zoom:e.zoom,center:e.center}},[e._l(e.markermap,function(e,t){return a("el-amap-marker",{key:e.index,attrs:{position:e.position,icon:e.icon,title:e.title,events:e.events,visible:e.visible,draggable:e.draggable,vid:t}})}),e._v(" "),a("el-amap-info-window",{attrs:{position:e.currentWindow.position,content:e.currentWindow.content,visible:e.currentWindow.visible,events:e.currentWindow.events}})],2)],1)])],1)],1),e._v(" "),a("el-form-item",{staticClass:"formfooter"},[a("el-button",{directives:[{name:"noMoreClick",rawName:"v-noMoreClick"}],attrs:{type:"primary"},on:{click:function(t){return e.handleSubmit("ruleForm")}}},[e._v("立即提交")]),e._v(" "),a("el-button",{on:{click:function(t){return e.closeAddBox()}}},[e._v("关闭")])],1)],1)],1)],1)],1)])],1)},staticRenderFns:[]};var u=a("VU/8")(d,c,!1,function(e){a("kTYJ")},null,null);t.default=u.exports}});