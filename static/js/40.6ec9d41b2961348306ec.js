webpackJsonp([40],{"+YmF":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("woOf"),r=a.n(i),n={components:{pagination:a("MCsY").a},data:function(){var t=this;return{userType:"",industryName:"",tableData:[],pageNum:1,pageSize:10,total:200,transfer:!1,transfer_title:["未关联的单位列表","已关联的单位列表"],data:[],transferValue:[],filterText:"",Treedata:[],unitId:"",addAreaFlag:!0,treedefaultProps:{children:"children",label:"label"},filterMethod:function(t,e){return e.initial.indexOf(t)>-1},ruleForm:{industryName:"",movekeys:[],delete:[]},rules:{industryName:[{validator:function(e,a,i){a?t.axios({method:"post",url:"/api/admin/industry/manager/unit/name/isexist",data:{industryName:a,unitId:t.unitId,industryId:t.ruleForm.id,pageSize:1,pageNum:1}}).then(function(t){0==t.data.code?i():i(new Error(t.data.msg))}):i(new Error("行业名称不能为空"))},required:!0,trigger:"blur"}]},singleData:[]}},methods:{changeTransfer:function(t,e,a){if("left"==e){for(var i in a){for(var r in this.ruleForm.movekeys)a[i]==this.ruleForm.movekeys[r]&&this.ruleForm.movekeys.splice(r,1);for(var n in this.singleData)a[i]==this.singleData[n]&&this.ruleForm.delete.push(a[i])}console.log("left"),console.log(this.ruleForm.delete),console.log(this.ruleForm.movekeys)}else{for(var i in a){for(var r in this.ruleForm.delete)a[i]==this.ruleForm.delete[r]&&this.ruleForm.delete.splice(r,1);if(this.ruleForm.id){var s=0;for(var n in this.singleData)a[i]==this.singleData[n]&&(s=1);1!=s&&this.ruleForm.movekeys.push(a[i])}else this.ruleForm.movekeys.push(a[i])}console.log("right"),console.log(this.ruleForm.delete),console.log(this.ruleForm.movekeys)}},SperRela:function(t){this.getSingle(t),this.ruleForm.movekeys=[],this.ruleForm.delete=[]},getSingle:function(t){var e=this;e.singleData=[],this.axios({url:"/api/admin/industry/manager/unit/detail",method:"post",data:{id:t}}).then(function(t){0==t.data.code?(e.ruleForm.industryName=t.data.data.industryName,e.ruleForm.id=t.data.data.id,e.singleData=t.data.data.unitIds,e.getTranfer(t.data.data.unitIds)):e.$alert(t.data.msg,"提示",{confirmButtonText:"OK"})})},getTranfer:function(t){this.data=[],this.transferValue=[];var e=this;e.initials=[],this.axios({url:"api/admin/unit/sub/ids",method:"post",data:{id:this.unitId}}).then(function(a){if(0==a.data.code){for(var i=a.data.data.children,r=0;r<i.length;r++)e.initials.push(i[r].label),e.data.push({label:i[r].label,key:i[r].value,initial:e.initials[r]});t&&(e.transferValue=t,e.transfer=!0)}})},Closetransfer:function(){this.transfer=!1,delete this.ruleForm.id,r()(this.$data.ruleForm,this.$options.data().ruleForm)},filterNode:function(t,e){return!t||-1!==e.label.indexOf(t)},renderContent:function(t,e){var a=e.node;return t("span",[t("i",{class:e.data.icon})," ",t("span",[a.label])])},handleNodeClick:function(t){this.unitId=t.id,0==t.type?this.addAreaFlag=!0:this.addAreaFlag=!1,this.getData()},searchreset:function(){this.industryName=""},searchData:function(){this.pageNum=1,this.$refs.paginationChild.changePageNum(this.pageNum),this.getData()},getTreeData:function(){var t=this;this.axios({url:"/api/admin/unit/list/left",method:"post",data:{pageNum:1e3,pageSize:1}}).then(function(e){0==e.data.code?t.Treedata=e.data.data:t.$alert(e.data.msg,"提示",{confirmButtonText:"OK"})})},openTranferBox:function(){this.transfer=!0,this.ruleForm.movekeys=[],this.ruleForm.delete=[],this.getTranfer()},handleSubmit:function(t){var e=this,a=this;this.$refs[t].validate(function(t){if(t){var i="/api/admin/industry/manager/unit/register";e.ruleForm.id?(i="/api/admin/industry/manager/unit/update",e.axios({url:i,method:"post",data:{id:e.ruleForm.id,managerUnitId:e.unitId,add:e.ruleForm.movekeys,delete:e.ruleForm.delete,industryName:e.ruleForm.industryName}}).then(function(t){0==t.data.code?a.$alert("关联成功","提示",{confirmButtonText:"OK",callback:function(){a.Closetransfer(),a.getData()}}):a.$alert(t.data.msg,"提示",{confirmButtonText:"OK"})})):e.axios({url:i,method:"post",data:{managerUnitId:e.unitId,subUnitIds:e.ruleForm.movekeys,industryName:e.ruleForm.industryName}}).then(function(t){0==t.data.code?a.$alert("关联成功","提示",{confirmButtonText:"OK",callback:function(){a.Closetransfer(),a.getData()}}):a.$alert(t.data.msg,"提示",{confirmButtonText:"OK"})})}})},handleReset:function(){this.ruleForm.industryName="",this.getTranfer()},getData:function(){var t=this;this.axios({url:"/api/admin/industry/manager/unit/search/page",method:"post",data:{pageNum:this.pageNum,pageSize:this.pageSize,unitId:this.unitId,industryName:this.industryName}}).then(function(e){if(0==e.data.code){for(var a in t.tableData=e.data.list,t.tableData)for(var i in t.tableData[a].list="",t.tableData[a].unitNameList)t.tableData[a].list+=t.tableData[a].unitNameList[i]+" 、 ";t.total=e.data.total}else t.$alert(e.data.msg,"提示",{confirmButtonText:"OK"})})},deleteBox:function(t){var e=this,a=this;this.$confirm("你确定要删除吗").then(function(){e.axios({url:"/api/admin/industry/manager/unit/delete",method:"post",data:{id:t}}).then(function(t){0==t.data.code?a.$alert("删除成功","提示",{confirmButtonText:"OK",callback:function(){a.getData()}}):a.$alert(t.data.msg,"提示",{confirmButtonText:"OK"})})})},pageChange:function(t){this.pageNum=t.page_index,this.pageSize=t.page_limit,this.getData()}},watch:{filterText:function(t){this.$refs.tree.filter(t)}},mounted:function(){this.userType=sessionStorage.getItem("userTypes"),2==this.userType?(this.unitId=sessionStorage.getItem("unitId"),this.addAreaFlag=!1):this.getTreeData(),this.getData()}},s={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"allcontent",attrs:{id:"unitIndustry"}},[1==t.userType?a("el-col",{staticClass:"tree_box",attrs:{span:4}},[a("div",[a("el-input",{staticClass:"filter_text",attrs:{placeholder:"输入关键字进行过滤"},model:{value:t.filterText,callback:function(e){t.filterText=e},expression:"filterText"}}),t._v(" "),a("el-tree",{ref:"tree",attrs:{data:t.Treedata,props:t.treedefaultProps,"render-content":t.renderContent,"highlight-current":"","filter-node-method":t.filterNode},on:{"node-click":t.handleNodeClick}})],1)]):t._e(),t._v(" "),a("el-col",{staticStyle:{height:"100%","padding-left":"10px"},attrs:{span:20}},[a("div",{staticClass:"top"},[t._v("\n            行业名称:"),a("el-input",{attrs:{placeholder:"搜索名称"},model:{value:t.industryName,callback:function(e){t.industryName=e},expression:"industryName"}}),t._v("  \n            "),a("el-button",{attrs:{type:"primary"},on:{click:t.searchData}},[t._v("查询")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.searchreset}},[t._v("重置")]),t._v(" "),a("el-button",{attrs:{type:"primary",disabled:t.addAreaFlag},on:{click:t.openTranferBox}},[t._v("新增行业")])],1),t._v(" "),a("div",{staticClass:"bottom"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,border:""}},[a("el-table-column",{attrs:{prop:"industryName",label:"行业名称",width:"140"}}),t._v(" "),a("el-table-column",{attrs:{prop:"list",label:"单位集合",width:"800"}}),t._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return t.SperRela(e.row.id)}}},[t._v("编辑")]),t._v(" "),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return t.deleteBox(e.row.id)}}},[t._v("删除")])]}}])})],1),t._v(" "),a("div",{staticClass:"page_all"},[a("pagination",{ref:"paginationChild",attrs:{total:t.total},on:{pageChange:t.pageChange}})],1),t._v(" "),a("div",{staticClass:"dialog_transfer"},[a("el-dialog",{attrs:{title:"提示",visible:t.transfer,width:"50%","close-on-click-modal":!1,"modal-append-to-body":!1,"before-close":t.Closetransfer},on:{"update:visible":function(e){t.transfer=e}}},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{rules:t.rules,model:t.ruleForm,data:t.ruleForm,"status-icon":"","label-width":"150px"}},[a("el-form-item",{attrs:{label:"区域名称",prop:"industryName"}},[a("el-input",{model:{value:t.ruleForm.industryName,callback:function(e){t.$set(t.ruleForm,"industryName",e)},expression:"ruleForm.industryName"}})],1),t._v(" "),a("el-transfer",{attrs:{filterable:"","filter-method":t.filterMethod,"filter-placeholder":"State Abbreviations",titles:t.transfer_title,data:t.data},on:{change:t.changeTransfer},model:{value:t.transferValue,callback:function(e){t.transferValue=e},expression:"transferValue"}}),t._v(" "),a("el-form-item",{staticClass:"formfooter"},[a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.handleSubmit("ruleForm")}}},[t._v("立即提交")]),t._v(" "),a("el-button",{on:{click:function(e){return t.Closetransfer()}}},[t._v("取消")])],1)],1)],1)],1)],1)])],1)},staticRenderFns:[]};var l=a("VU/8")(n,s,!1,function(t){a("q1me")},null,null);e.default=l.exports},q1me:function(t,e){}});